{
  "noFrames" : true,
  "name" : "115转存助手ui优化版v2.2",
  "injectTime" : 1,
  "type" : 1,
  "matchValue" : "",
  "code" : "Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAxMTXovazlrZjliqnmiYt1aeS8mOWMlueJiHYyLjIKLy8gQG5hbWU6emggICAgICAxMTXovazlrZjliqnmiYt1aeS8mOWMlueJiHYyLjIKLy8gQGF1dGhvciAgICAgICBOZXZlcjRFdmVyCi8vIEBuYW1lc3BhY2UgICAgRmFrZTExNVVwbG9hZEBOZXZlcjRFdmVyCi8vIEB2ZXJzaW9uICAgICAgMS40LjMuMjAyMTA0MjIuMAovLyBAZGVzY3JpcHRpb24gIDExNeaWh+S7tui9rOWtmO+8iChiYXNlZCBvbiBGYWtlMTE1VXBsb2FkIDEuNC4zIEBUM3JyeSnvvIkKLy8gQG1hdGNoICAgICAgICBodHRwczovLzExNS5jb20vKgovLyBAZ3JhbnQgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICAgICAgR01fbG9nCi8vIEBncmFudCAgICAgICAgR01fc2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX3NldENsaXBib2FyZAovLyBAZ3JhbnQgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAY29ubmVjdCAgICAgIHByb2FwaS4xMTUuY29tCi8vIEBjb25uZWN0ICAgICAgd2ViYXBpLjExNS5jb20KLy8gQGNvbm5lY3QgICAgICAxMTUuY29tCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9jZG4uYm9vdGNzcy5jb20vanNTSEEvMi4zLjEvc2hhMS5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy81MzkyLXdhaXRmb3JrZXllbGVtZW50cy9jb2RlL1dhaXRGb3JLZXlFbGVtZW50cy5qcz92ZXJzaW9uPTExNTAxMgovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vdW5kZXJzY29yZUAxLjEyLjAvdW5kZXJzY29yZS1taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3N3ZWV0YWxlcnQyQDgKLy8gQHJlcXVpcmUgICAgICBodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL25vZGUtZm9yZ2VAMC4xMC4wL2Rpc3QvZm9yZ2UubWluLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioK6K+35LuO5Lul5LiL6I635Y+W5pyA5paw54mI77yM5oiW6ICF6YGH5Yiw6Zeu6aKY5Y675q2k5Y+N6aaI77yM5oSf6LCiCmh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvemgtQ04vc2NyaXB0cy80MjI2MTktMTE1JUU4JUJEJUFDJUU1JUFEJTk4JUU1JThBJUE5JUU2JTg5JThCdWklRTQlQkMlOTglRTUlOEMlOTYlRTclODklODh2Mi0yCgrmnIlidWflj43ppojkvJrlj4rml7bmm7TmlrDjgILlpoLmnpzpgYfliLAxMTXmjqXlj6Ppl67popjvvIzlvpfnrYnlpKfkvazku6zop6PlhrPvvIzmiJHlj6rmmK\/mi77kurrniZnmhafvvIzlgZrngrnlvq7lsI\/nmoTlt6XkvZwKCuWcqDIwMjEuMDQuMTcg5pe25ZyoY2hyb21l5LiOMTE1cGPvvIh2MjTvvInkuIrvvIzovazlrZjkuI7mj5Dlj5bmtYvor5XnmobmraPluLgKCgojIyMg5Li76KaB5Yqf6IO977yaCiog5o+Q5Y+W55qE5pe25YCZ5bim55uu5b2V77yM5pys6ISa5pys55uu5b2V55So4oCcfOKAneWIhuWJsgoqIOaUr+aMgeW4puebruW9lei9rOWtmO+8jOWMheaLrOaUr+aMgSDnlKjigJx84oCd5oiW6ICF6K665Z2b6YeM55So4oCcI+KAneWIhuWJsueahO+8jOaUr+aMgWpzb27moLzlvI\/vvIjmoLzlvI\/kuLp7ImRpcl9uYW1lIjoiIiwiZmlsZXMiOltdLCJkaXJzIjpbXX3vvIkKKiDmlK\/mjIHovazlrZjml7bpgInmi6nkuI3oh6rliqjliJvlu7rnm67lvZUKKiDmlK\/mjIHmkJzntKLpobXpnaLnmoTmj5Dlj5YKKiDph43mlrDliIbmnpDkuoZAVDNycnnlpKfkvaznmoTku6PnoIHvvIzloavkuobku6XliY3mj5Dlj5botoXlpKfph4\/mlofku7blrZjlnKjnmoTlnZEKKiDkvJjljJbkuobmk43kvZzov5vluqbmj5DnpLoKKiDmlK\/mjIHnm7TmjqXpgInmi6nlr7zlhaVzaGEx6ZO+5o6l5paH5Lu277yI56ym5ZCI5qC85byP55qELnR4dOWSjC5qc29u77yJCgoKIyMjIOazqOaEj++8mgoqIOaPkOWPluaXtumBh+WIsOS4jeiDveS4i+i9veeahOaWh+S7tuiOt+WPluWIsHNoYTHpk77mjqXvvIjmnKzohJrmnKznlKg0MOS4qjDmm7\/mjaLvvInmmK\/mmoLml7bmnInmlYjnmoTvvIznrYnmlofku7bog73kuIvovb3kuoblsLHkvJrlpLHmlYgKKiDovazlrZjml7bmnKrov4fmu6Tnqbrnm67lvZXvvIzmiJbogIXnlLHkuo7ovazlrZjlpLHotKXkvJrlr7zoh7Tnqbrnm67lvZXlrZjlnKgKKiDkvb\/nlKjml7bvvIzkuI3opoHmnIDlsI\/ljJbmtY\/op4jlmajlkozliIfmjaJ0YWLpobXpnaLvvIzljbPvvJrpnIDopoHkv53mjIHmk43kvZzpobXpnaLlp4vnu4jlj6\/op4EKKiDpgILnlKjkuo5jaHJvbWXmiJbogIU8ZGVsPnYyM+eJiOacrOeahDwvZGVsPu+8iOaWsOeJiOW3sue7j+aUr+aMgXYyNO+8iTExNe+8jOS7peWPiuWvvOWFpeeahOaWh+S7tumcgOimgeS4unV0Zi0457yW56CBCiog5aaC5p6c6L2s5a2Y5aSx6LSl77yM6K+35qOA5p+l6ZO+5o6l5oiW6ICF5ZyoY2hyb21l5LiK6L+b6KGM5bCd6K+V77yMMTE1cGPnq6\/lgbblsJTmir3po47vvJvmiJbogIXlj6\/og73kuI7lhbbku5bohJrmnKzlhrLnqoHvvIzlr7zoh7TmmL7npLrlhYPntKDkuI3lrozmlbQKKiDpgYfliLDpl67popjvvIzlj43ppojml7bor7fmj4\/ov7DkvaDkvb\/nlKjnmoTjgJDmtY\/op4jlmajjgJHvvIzjgJDmtY\/op4jlmajniYjmnKzjgJHvvIzjgJDku4DkuYjmk43kvZzjgJHvvIzjgJDpk77mjqXjgJHvvIzjgJDplJnor6\/mj5DnpLrjgJHvvIzopoHkuI3nhLbml6Dms5Xov5vooYzplJnor6\/lpI3njrDjgIIKCiMjIyDmnIDov5Hmm7TmlrDml6Xlv5fvvJoKKiAxLjQuMy4yMDIxMDQyMi4wCuS8mOWMluaPkOekuuasoeaVsO+8muavj+WkqTHmrKHvvJvkvJjljJblpKflsI\/kuLow55qE5paH5Lu25o+Q5Y+WCiogMS40LjMuMjAyMTA0MTUuMArkuI3og73kuIvovb3nmoTmlofku7bmj5DkvpvmmoLml7bnmoTovazlrZjpk77mjqXvvIw0MOS4qjDnu5PlsL7vvIzms6jmhI\/vvJrmlofku7bog73kuIvovb3ml7bvvIzor6Xpk77mjqXlsLHkvJrkuI3ljLnphY3vvIEK5L+u5aSN5aSa6YeN55uu5b2V6L2s5a2Y5pe25Y+v6IO95a2Y5Zyo57uT5p6E6ZSZ5L2N55qE6Zeu6aKYCiogMS40LjMuMjAyMTAzMDcuMQrigJzovazlrZjigJ3lpITlop7liqDigJzopoHkuI3opoHliJvlu7rnm67lvZXigJ3nmoTpgInmi6npobkK5pCc57Si5aSE5aKe5Yqg5LqG5Y2V5Liq5paH5Lu25bey57uP5Y2V5Liq55uu5b2V55qEc2hhMeaPkOWPlu+8iOm8oOagh+aCrOWBnOaXtueahHRvb2x0aXDkuIrvvIkK5pCc57Si5aSE5aKe5Yqg5a+55pys6aG15omA5pyJ5ZKM6YCJ5Lit55qE5paH5Lu255qE5o+Q5Y+W77yI5o6S6Zmk55uu5b2V77yM5Zug5Li66L+Z5qC35Y+v6IO95Lya6YeN5aSN5o+Q5Y+W5paH5Lu277yb5bm25LiU5Y+q5piv5b2T5YmN6aG177yJCiogMS40LjMuMjAyMTAzMDUuMArkv67lpI0xMTVwY+eJiHYyNOeJiO+8iHYyNC4wLjIuMu+8ieaPkOWPlueahOaUr+aMgQoqIDEuNC4zLjIwMjEwMzA0LjIK5L+u5aSN6L2s5a2Y5pe26YGH5YiwJuWvvOiHtOeahOmXrumimO+8jOWMheaLrOaWh+S7tuWQjeaIquaWreS7peWPiuebruW9leWIm+W7uuWksei0pQrkv67lpI3mnKrliLfmlrDnvZHpobXnmoTmg4XlhrXkuIvlj6\/og73lnKjmnKrpgInmi6nmlofku7bnmoTmg4XlhrXkuIvvvIzph43lpI3kvb\/nlKjkuIrmrKHmlofku7bnmoTmg4XlhrUKKiAxLjQuMy4yMDIxMDMwNC4xCuino+WGs+eUseS6juKAnOW8guW4uOaWh+S7tu+8jOaXoOazleS4i+i9veKAneWvvOiHtOaPkOWPluWNoeS9j+eahGJ1ZwrkvJjljJbovazlrZjlh7rplJnml7bnmoTmj5DphpIKKiAxLjQuMy4yMDIxMDMwMy4xCuWxj+iUvWVzY+WHj+WvvOiHtOi\/m+W6puadoeW8ueeql+mAgOWHugrkvJjljJblubPooaHpgJ\/luqYKKiAxLjQuMy4yMDIxMDMwMgrmlK\/mjIHnm7TmjqXlr7zlhaVzaGEx6ZO+5o6l5paH5Lu277yI56ym5ZCI5qC85byP55qELnR4dOWSjC5qc29u77yJCuS8mOWMluaPkOWPluetlueVpe+8jOWkp+S6jjEyMDDmlbDph4\/vvIzmhaLpgJ8KKiAxLjQuMy4yMDIxMDMwMQrkv67lpI3lkIzkuIDnm67lvZXkuIvlrZjlnKjnm7jlkIzmlofku7blr7zoh7Tmj5Dlj5bmrbvlvqrnjq\/nmoRidWcKKiAxLjQuMy4yMDIxMDIyNwrorqHmlbBidWfkv67mlLnvvIzkv67mlLnku6PnoIHpgILphY0xMTXmtY\/op4jlmagKKiAxLjQuMy4yMDIxMDIwOQrkvJjljJbku6PnoIHvvIzlop7liqDnm67lvZUKKiAuLi4uLi4KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8vaW5pdCBzZXR0aW5nCiAgICB3YWl0Rm9yS2V5RWxlbWVudHMoImRpdi5maWxlLW9wciIsIEFkZFNoYXJlU0hBMUJ0bik7CiAgICB3YWl0Rm9yS2V5RWxlbWVudHMoImRpdi5kaWFsb2ctYm90dG9tIiwgQWRkRG93bmxvYWRTaGExQnRuKTsKICAgIHdhaXRGb3JLZXlFbGVtZW50cygiZGl2LmxzdGMtc2VhcmNoIixBZGRTaGFyZUJ1dHRvbkZvclNlYXJjaEl0ZW0pOwoKICAgIHZhciBwX3podWFuY3VuID0gJzxhIGhyZWY9ImphdmFzY3JpcHQ6OyIgIGNsYXNzPSJidXR0b24gYnRuLWxpbmUgYnRuLXVwbG9hZCIgbWVudT0ib2ZmbGluZV90YXNrIj48aSBjbGFzcz0iaWNvbi1vcGVyYXRlIGlmby1saW5rdGFzayI+PC9pPjxzcGFuPumTvuaOpeS7u+WKoTwvc3Bhbj48ZW0gc3R5bGU9ImRpc3BsYXk6bm9uZTsiIGNsYXNzPSJudW0tZG90Ij48L2VtPjwvYT4nOwogICAgJCgiLmxlZnQtdHZmIikuZXEoMCkuYXBwZW5kKHBfemh1YW5jdW4pOwoKICAgIHdpbmRvdy5jb29raWUgPSBkb2N1bWVudC5jb29raWUKCiAgICB2YXIgd29ya2luZ051bWJlcnMgPSA0OwoKICAgIGNvbnN0IHVzZXJBZ2VudD0iTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84My4wLjQxMDMuNjEgU2FmYXJpLzUzNy4zNiAxMTVCcm93c2VyLzIzLjkuMy42IjsKICAgIGNvbnN0IHRoaXNWZXJzaW9uPSIxLjQuMy4yMDIxMDQyMi4wIjsKCiAgICAvLyNyZWdpb24gMjAyMDEyMzDmlrDnmoTmj5Dlj5ZhcGnnm7jlhbMKICAgIHZhciBwdWJfa2V5ID0gJy0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXAogICAgTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FEUjNyV21lWW5SQ2x3TEJCMFJxMGRsbThNclwKICAgIFBtV3BMNUkyM1N6Q0ZBb05wSlg2RG43NGRmYjZ5MDJZSDE1ZU82WG1lQkhkYzdla0VGSlVJaStzd2dhblRva1JcCiAgICBJVlJSci96MTYvM29oN3lhMjJkY0FxZzE5MXkrZDZZRHI0SUdnL1E1NTg3VUtKTWozNXlRVlhhZUZYbUxsRlBvXAogICAga0ZpejR1UHhockI3QkdxWmJRSURBUUFCXAogICAgLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tJwogICAgdmFyIHByaXZhdGVfa2V5ID0gJy0tLS0tQkVHSU4gUlNBIFBSSVZBVEUgS0VZLS0tLS1cCiAgICBNSUlDWEFJQkFBS0JnUUNNZ1VKTHdXYjBrWWRXNmZleUx2cWdOSG13Z2VZWWxvY3N0OFVja1ExK3dhVE9LSEZDXAogICAgVFZ5UlNiMWVDS0paV2FHYTA4bUI1bEV1L2FzcnVOby9IakZjS1V2UkY2bjduWXpvNWpPMGxpNElmR0tkeHNvNlwKICAgIEZKSVV0QWtlOHJBMlBMT3ViSDduQWpkL0JWN1R6WlAydzBJbGFuWlZTNzZuOGdORGU3NWw4dG9uUVFJREFRQUJcCiAgICBBb0dBTndUYXNBMkF3bDVHVC90NFdoYlpYMmlOQ2xnamdSZFl3V01JMWFIYlZmcUFEWlo2bTBydDU1cW5nNjMvXAogICAgM05zalZCeUF1TlEya0I4WEt4ek1vWkN5Sk52bmQ3OFl1VzNab3dxczZIZ0RVSGs2VDVDbVJhZDBmdmFWWWk2dFwKICAgIHZpT2t4dGlQSXVoNFFyUTdOVWhzTFJ0Ykg2ZDlzMUtMQ1JES2hPMjNwR3I5dnRFQ1FRRHBqS1lzc0Yra3E5aXlcCiAgICBBOVd2WFJqYlk5K2NhMjdZZmFyRDlXVnpXUzJyRmc4TXNDYnZDbzllYlhjbWp1NDRRaENnaFFGSVZYdWViUTdRXAogICAgcHlkdnFGMGxBa0VBbWdMbmliMVhvbllPeGpWSk0yanF5NXpFR2U2dnpnOGFTd0tDWWVjMTRpaUpLbUVZY1A0elwKICAgIERTUm1zNDNoblFzcDhNMnluam5zWUNqeWllZ2crQVo4N1FKQU51d3dtQW5TTkRPRmZqZVFwUERMeTZ3dEJlZnRcCiAgICA1Vk9JT1JVWWlvdktSWldtYkdGd2huNkJRTCtWYWFmck5hZXpxVXdlQlJpMVBZaUFGMmwzeUxaYlVRSkFmL25OXAogICAgNEh6L3B6WW16TGxXbkd1Z1A1V0N0bkhLa0pXb0taQnFPMlJmT0JDcStoWTRzeHZuM0JIVmJYcUdjWExuWlB2b1wKICAgIFl1YUs3dFRYeFpTb1lMRXplUUpCQUw4TXQzQWtGMUdjaTVIT3VnNmpUNHM0WitxRERyVVhvOUJsVHdTV1A5MHZcCiAgICB3bEhGK21rVEpwS2Q1V2FjZWYwdlYreHVtcU5vcnZMcElYV0t3eE5hb0hNPVwKICAgIC0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tJwoKICAgIGNvbnN0IHByaXYgPSBmb3JnZS5wa2kucHJpdmF0ZUtleUZyb21QZW0ocHJpdmF0ZV9rZXkpOwogICAgY29uc3QgcHViID0gZm9yZ2UucGtpLnB1YmxpY0tleUZyb21QZW0ocHViX2tleSk7CiAgICBjb25zdCBnX2tleV9sID0gWzB4NDIsIDB4ZGEsIDB4MTMsIDB4YmEsIDB4NzgsIDB4NzYsIDB4OGQsIDB4MzcsIDB4ZTgsIDB4ZWUsIDB4MDQsIDB4OTFdCiAgICBjb25zdCBnX2tleV9zID0gWzB4MjksIDB4MjMsIDB4MjEsIDB4NWVdCiAgICBjb25zdCBnX2t0cyA9IFsweGYwLCAweGU1LCAweDY5LCAweGFlLCAweGJmLCAweGRjLCAweGJmLCAweDVhLCAweDFhLCAweDQ1LCAweGU4LCAweGJlLCAweDdkLCAweGE2LCAweDczLCAweDg4LCAweGRlLCAweDhmLCAweGU3LCAweGM0LCAweDQ1LCAweGRhLCAweDg2LCAweDk0LCAweDliLCAweDY5LCAweDkyLCAweDBiLCAweDZhLCAweGI4LCAweGYxLCAweDdhLCAweDM4LCAweDA2LCAweDNjLCAweDk1LCAweDI2LCAweDZkLCAweDJjLCAweDU2LCAweDAwLCAweDcwLCAweDU2LCAweDljLCAweDM2LCAweDM4LCAweDYyLCAweDc2LCAweDJmLCAweDliLCAweDVmLCAweDBmLCAweGYyLCAweGZlLCAweGZkLCAweDJkLCAweDcwLCAweDljLCAweDg2LCAweDQ0LCAweDhmLCAweDNkLCAweDE0LCAweDI3LCAweDcxLCAweDkzLCAweDhhLCAweGU0LCAweDBlLCAweGMxLCAweDQ4LCAweGFlLCAweGRjLCAweDM0LCAweDdmLCAweGNmLCAweGZlLCAweGIyLCAweDdmLCAweGY2LCAweDU1LCAweDlhLCAweDQ2LCAweGM4LCAweGViLCAweDM3LCAweDc3LCAweGE0LCAweGUwLCAweDZiLCAweDcyLCAweDkzLCAweDdlLCAweDUxLCAweGNiLCAweGYxLCAweDM3LCAweGVmLCAweGFkLCAweDJhLCAweGRlLCAweGVlLCAweGY5LCAweGM5LCAweDM5LCAweDZiLCAweDMyLCAweGExLCAweGJhLCAweDM1LCAweGIxLCAweGI4LCAweGJlLCAweGRhLCAweDc4LCAweDczLCAweGY4LCAweDIwLCAweGQ1LCAweDI3LCAweDA0LCAweDVhLCAweDZmLCAweGZkLCAweDVlLCAweDcyLCAweDM5LCAweGNmLCAweDNiLCAweDljLCAweDJiLCAweDU3LCAweDVjLCAweGY5LCAweDdjLCAweDRiLCAweDdiLCAweGQyLCAweDEyLCAweDY2LCAweGNjLCAweDc3LCAweDA5LCAweGE2XQogICAgdmFyIG0xMTVfbF9ybmRfa2V5ID0gZ2VuUmFuZG9tKDE2KQogICAgdmFyIG0xMTVfc19ybmRfa2V5ID0gW10KICAgIHZhciBrZXlfcyA9IFtdCiAgICB2YXIga2V5X2wgPSBbXQogICAgZnVuY3Rpb24gaW50VG9CeXRlKGkpIHsKICAgICAgICB2YXIgYiA9IGkgJiAweEZGOwogICAgICAgIHZhciBjID0gMDsKICAgICAgICBpZiAoYiA+PSAyNTYpIHsKICAgICAgICAgICAgYyA9IGIgJSAyNTY7CiAgICAgICAgICAgIGMgPSAtMSAqICgyNTYgLSBjKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjID0gYjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMKICAgIH0KICAgIGZ1bmN0aW9uIHN0cmluZ1RvQXJyYXkocykgewogICAgICAgIHZhciBtYXAgPSBBcnJheS5wcm90b3R5cGUubWFwCiAgICAgICAgdmFyIGFycmF5ID0gbWFwLmNhbGwocywgZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHguY2hhckNvZGVBdCgwKTsKICAgICAgICB9KQogICAgICAgIHJldHVybiBhcnJheQogICAgfQogICAgZnVuY3Rpb24gYXJyYXlUb3N0cmluZyhhcnJheSkgewogICAgICAgIHZhciByZXN1bHQgPSAiIjsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHJlc3VsdCArPSAoU3RyaW5nLmZyb21DaGFyQ29kZShhcnJheVtpXSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZnVuY3Rpb24gbTExNV9pbml0KCkgewogICAgICAgIGtleV9zID0gW10KICAgICAgICBrZXlfbCA9IFtdCiAgICB9CiAgICBmdW5jdGlvbiBtMTE1X3NldGtleShyYW5ka2V5LCBza19sZW4pIHsKICAgICAgICB2YXIgbGVuZ3RoID0gc2tfbGVuICogKHNrX2xlbiAtIDEpCiAgICAgICAgdmFyIGluZGV4ID0gMAogICAgICAgIHZhciB4b3JrZXkgPSAnJwogICAgICAgIGlmIChyYW5ka2V5KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2tfbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciB4ID0gaW50VG9CeXRlKChyYW5ka2V5W2ldKSArIChnX2t0c1tpbmRleF0pKQogICAgICAgICAgICAgICAgeG9ya2V5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZ19rdHNbbGVuZ3RoXSBeIHgpCiAgICAgICAgICAgICAgICBsZW5ndGggLT0gc2tfbGVuCiAgICAgICAgICAgICAgICBpbmRleCArPSBza19sZW4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2tfbGVuID09IDQpIHsKICAgICAgICAgICAgICAgIGtleV9zID0gc3RyaW5nVG9BcnJheSh4b3JrZXkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoc2tfbGVuID09IDEyKSB7CiAgICAgICAgICAgICAgICBrZXlfbCA9IHN0cmluZ1RvQXJyYXkoeG9ya2V5KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24geG9yMTE1X2VuYyhzcmMsIGtleSkgewogICAgICAgIHZhciBsa2V5ID0ga2V5Lmxlbmd0aAogICAgICAgIHZhciBzZWNyZXQgPSBbXQogICAgICAgIHZhciBudW0gPSAwCiAgICAgICAgdmFyIHBhZCA9IChzcmMubGVuZ3RoKSAlIDQKICAgICAgICBpZiAocGFkID4gMCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhZDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzZWNyZXQucHVzaCgoc3JjW2ldKSBeIGtleVtpXSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzcmMgPSBzcmMuc2xpY2UocGFkKQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNyYy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAobnVtID49IGxrZXkpIHsKICAgICAgICAgICAgICAgIG51bSA9IG51bSAlIGxrZXkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWNyZXQucHVzaCgoc3JjW2pdIF4ga2V5W251bV0pKQogICAgICAgICAgICBudW0gKz0gMQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VjcmV0CgogICAgfQogICAgZnVuY3Rpb24gZ2VuUmFuZG9tKGxlbikgewogICAgICAgIHZhciBrZXlzID0gW10KICAgICAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hKS01OUFFSU1RXWFlaYWJjZGVmaGlqa21ucHJzdHd4eXoyMzQ1Njc4OSc7CiAgICAgICAgdmFyIG1heFBvcyA9IGNoYXJzLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGtleXMucHVzaChjaGFycy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4UG9zKSkuY2hhckNvZGVBdCgwKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBrZXlzOwogICAgfQogICAgZnVuY3Rpb24gbTExNV9lbmNvZGUocGxhaW50ZXh0KSB7CiAgICAgICAgY29uc29sZS5sb2coJ20xMTVfZW5jb2RlOicpCiAgICAgICAgbTExNV9pbml0KCkKICAgICAgICBrZXlfbCA9IGdfa2V5X2wKICAgICAgICBtMTE1X3NldGtleShtMTE1X2xfcm5kX2tleSwgNCkKICAgICAgICB2YXIgdG1wID0geG9yMTE1X2VuYyhzdHJpbmdUb0FycmF5KHBsYWludGV4dCksIGtleV9zKS5yZXZlcnNlKCkKICAgICAgICB2YXIgeG9ydGV4dCA9IHhvcjExNV9lbmModG1wLCBrZXlfbCkKICAgICAgICB2YXIgdGV4dCA9IGFycmF5VG9zdHJpbmcobTExNV9sX3JuZF9rZXkpICsgYXJyYXlUb3N0cmluZyh4b3J0ZXh0KQogICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gcHViLmVuY3J5cHQodGV4dCkKICAgICAgICBjaXBoZXJ0ZXh0ID0gZW5jb2RlVVJJQ29tcG9uZW50KGZvcmdlLnV0aWwuZW5jb2RlNjQoY2lwaGVydGV4dCkpCiAgICAgICAgcmV0dXJuIGNpcGhlcnRleHQKICAgIH0KICAgIGZ1bmN0aW9uIG0xMTVfZGVjb2RlKGNpcGhlcnRleHQpIHsKICAgICAgICBjb25zb2xlLmxvZygnbTExNV9kZWNvZGU6JykKICAgICAgICB2YXIgYmNpcGhlcnRleHQgPSBmb3JnZS51dGlsLmRlY29kZTY0KGNpcGhlcnRleHQpCiAgICAgICAgdmFyIGJsb2NrID0gYmNpcGhlcnRleHQubGVuZ3RoIC8gKDEyOCkKICAgICAgICB2YXIgcGxhaW50ZXh0ID0gJycKICAgICAgICB2YXIgaW5kZXggPSAwCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gYmxvY2s7ICsraSkgewogICAgICAgICAgICBwbGFpbnRleHQgKz0gcHJpdi5kZWNyeXB0KGJjaXBoZXJ0ZXh0LnNsaWNlKGluZGV4LCBpICogMTI4KSkKICAgICAgICAgICAgaW5kZXggKz0gMTI4CiAgICAgICAgfQogICAgICAgIG0xMTVfc19ybmRfa2V5ID0gc3RyaW5nVG9BcnJheShwbGFpbnRleHQuc2xpY2UoMCwgMTYpKQogICAgICAgIHBsYWludGV4dCA9IHBsYWludGV4dC5zbGljZSgxNik7CiAgICAgICAgbTExNV9zZXRrZXkobTExNV9sX3JuZF9rZXksIDQpCiAgICAgICAgbTExNV9zZXRrZXkobTExNV9zX3JuZF9rZXksIDEyKQogICAgICAgIHZhciB0bXAgPSB4b3IxMTVfZW5jKHN0cmluZ1RvQXJyYXkocGxhaW50ZXh0KSwga2V5X2wpLnJldmVyc2UoKQogICAgICAgIHBsYWludGV4dCA9IHhvcjExNV9lbmModG1wLCBrZXlfcykKICAgICAgICByZXR1cm4gYXJyYXlUb3N0cmluZyhwbGFpbnRleHQpCiAgICB9CgogICAgZnVuY3Rpb24gUG9zdERhdGEoZGljdCkgewogICAgICAgIHZhciBrLCB0bXAsIHY7CiAgICAgICAgdG1wID0gW107CiAgICAgICAgZm9yIChrIGluIGRpY3QpIHsKICAgICAgICAgICAgdiA9IGRpY3Rba107CiAgICAgICAgICAgIHRtcC5wdXNoKGsgKyAiPSIgKyB2KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRtcC5qb2luKCcmJyk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIFVybERhdGEoZGljdCkgewogICAgICAgIHZhciBrLCB0bXAsIHY7CiAgICAgICAgdG1wID0gW107CiAgICAgICAgZm9yIChrIGluIGRpY3QpIHsKICAgICAgICAgICAgdiA9IGRpY3Rba107CiAgICAgICAgICAgIHRtcC5wdXNoKChlbmNvZGVVUklDb21wb25lbnQoaykpICsgIj0iICsgKGVuY29kZVVSSUNvbXBvbmVudCh2KSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG1wLmpvaW4oJyYnKTsKICAgIH07CgogICAgZnVuY3Rpb24gR2V0U2lnKHVzZXJpZCwgZmlsZWlkLCB0YXJnZXQsIHVzZXJrZXkpIHsKICAgICAgICB2YXIgc2hhMSwgdG1wOwogICAgICAgIHNoYTEgPSBuZXcganNTSEEoJ1NIQS0xJywgJ1RFWFQnKTsKICAgICAgICBzaGExLnVwZGF0ZSgiIiArIHVzZXJpZCArIGZpbGVpZCArIGZpbGVpZCArIHRhcmdldCArICIwIik7CiAgICAgICAgdG1wID0gc2hhMS5nZXRIYXNoKCdIRVgnKTsKICAgICAgICBzaGExID0gbmV3IGpzU0hBKCdTSEEtMScsICdURVhUJyk7CiAgICAgICAgc2hhMS51cGRhdGUoIiIgKyB1c2Vya2V5ICsgdG1wICsgIjAwMDAwMCIpOwogICAgICAgIHJldHVybiBzaGExLmdldEhhc2goJ0hFWCcsIHsKICAgICAgICAgICAgb3V0cHV0VXBwZXI6IHRydWUKICAgICAgICB9KTsKICAgIH0KCgoKICAgIGZ1bmN0aW9uIGRvd25sb2FkKGZpbGVuYW1lLCBjb250ZW50LCBjb250ZW50VHlwZSkgewogICAgICAgIGlmICghY29udGVudFR5cGUpIGNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbY29udGVudF0sIHsgJ3R5cGUnOiBjb250ZW50VHlwZSB9KTsKICAgICAgICBhLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICBhLmRvd25sb2FkID0gZmlsZW5hbWU7CiAgICAgICAgYS5jbGljaygpOwogICAgfQoKICAgIGZ1bmN0aW9uIFJlbmV3Q29va2llKCkgewogICAgICAgIHZhciBhcnJ5Q29va2llID0gd2luZG93LmNvb2tpZS5zcGxpdCgnOycpOwogICAgICAgIGFycnlDb29raWUuZm9yRWFjaChmdW5jdGlvbiAoa3YpIHsKICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0ga3YgKyAiO2V4cGlyZXM9VGh1LCAwMSBKYW4gMjEwMCAwMDowMDowMCBVVEM7O2RvbWFpbj0uMTE1LmNvbSIKICAgICAgICB9CiAgICAgICAgKQogICAgfQoKICAgIGZ1bmN0aW9uIERlbGV0ZUNvb2tpZShyZXNwKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHJlZyA9IC9zZXQtY29va2llOiAuKzsvZzsKICAgICAgICAgICAgdmFyIHNldGNvb2tpZSA9IHJlZy5leGVjKHJlc3ApWzBdLnNwbGl0KCc7Jyk7CiAgICAgICAgICAgIHZhciBmaWxlY29va2llID0gc2V0Y29va2llWzBdLnNsaWNlKDExKSArICI7IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM7IiArIHNldGNvb2tpZVszXSArICI7ZG9tYWluPS4xMTUuY29tIjsKICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gZmlsZWNvb2tpZTsKICAgICAgICAgICAgUmVuZXdDb29raWUoKQogICAgICAgICAgICByZXR1cm4gZmlsZWNvb2tpZTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgoKCgogICAgLy8jZW5kcmVnaW9uCgogICAgZnVuY3Rpb24gaGVyZURvYyhmKSB7CiAgICAgICAgcmV0dXJuIGYudG9TdHJpbmcoKS5yZXBsYWNlKC9eW15cL10rXC9cKiE\/XHM\/LywgJycpLnJlcGxhY2UoL1wqXC9bXlwvXSskLywgJycpOwogICAgfQoKICAgIGNvbnN0IE1lc3NhZ2VUeXBlID0gewogICAgICAgIEJFR0lOOiAwLAogICAgICAgIFBST0NFU1NJTkc6IDEsCiAgICAgICAgRU5EOiAyLAogICAgICAgIEVSUk9SOiAzLAogICAgICAgIENMT1NFOiA0LAogICAgfTsKCiAgICBmdW5jdGlvbiBjcmVhdGVNZXNzYWdlKG1lc3NhZ2VUeXBlLCBtc2cpIHsKICAgICAgICByZXR1cm4geyBtZXNzYWdlVHlwZTogbWVzc2FnZVR5cGUsIG1zZzogbXNnIH0KICAgIH0KCiAgICBTdHJpbmcucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBzID0gdGhpcywgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcyA9IHMucmVwbGFjZShuZXcgUmVnRXhwKCJcXHsiICsgaSArICJcXH0iLCAiZyIpLCBhcmd1bWVudHNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAgIH07CgogICAgdmFyIGdldFRhbXBsYXRlTGluZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLyoKICAgICAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OjE4MHB4OyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpdGVtQ29udGVudCIgc3R5bGU9ImNvbG9yOiByZWQ7dGV4dC1hbGlnbjogbGVmdDttYXJnaW46IDEwcHggMDsiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8aHIgLz4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDoxNDBweDtvdmVyZmxvdy14OiBoaWRkZW47b3ZlcmZsb3cteTogYXV0bzsiPgogICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0iZXJyb3JMaXN0IiAgc3R5bGU9ImZvbnQtc2l6ZTogc21hbGw7dGV4dC1hbGlnbjogbGVmdDtmb250LXN0eWxlOiBpdGFsaWM7ICI+PC91bD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAqLwogICAgfTsKCgogICAgLy9wb3N0IGZyb20gaWZyYW1lCiAgICBmdW5jdGlvbiBwb3N0U2hhMU1lc3NnYWUobWVzc2FnZSkgewogICAgICAgIHZhciBwb3N0RGF0YSA9IHsKICAgICAgICAgICAgZXZlbnRJRDogIjExNXNoYTEiLAogICAgICAgICAgICBkYXRhOiBtZXNzYWdlCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHRleHQgPSBKU09OLnN0cmluZ2lmeShwb3N0RGF0YSk7CiAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh0ZXh0LCAiaHR0cHM6Ly8xMTUuY29tLyIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVRpcCgpCiAgICB7CiAgICAgICAgdmFyIHZlcnNpb249IEdNX2dldFZhbHVlKCJ2ZXJzaW9uIik7CiAgICAgICAgdmFyIGRhdGU9R01fZ2V0VmFsdWUoImRhdGUiKQogICAgICAgIHZhciBteURhdGU9IG5ldyBEYXRlKCk7CgogICAgICAgIGlmKGRhdGUhPW15RGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKSkKICAgICAgICB7CiAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICB0aXRsZTogJ+eJiOacrCh7MH0p5o+Q56S6Jy5mb3JtYXQodGhpc1ZlcnNpb24pLAogICAgICAgICAgICAgICAgaHRtbDogYDxkaXYgc3R5bGU9ImNvbG9yOiByZWQ7Ij7vvIHvvIHkuIrkuIflsI\/mlofku7bor7fmiZPljovnvKnljIXliIbkuqvvvIzlkKbliJnlj6\/og73kvJrooqvlsIHlj7fvvIHvvIE8L2Rpdj5gKwogICAgICAgICAgICAgICAgYDxocj5maXhlZO+8muS8mOWMluaPkOekuuasoeaVsO+8muavj+WkqTHmrKHvvJvkvJjljJblpKflsI\/kuLow55qE5paH5Lu25o+Q5Y+WYCsKICAgICAgICAgICAgICAgIGA8aHI+5pu05paw5oiW5Y+N6aaI77yM54K55Ye7LT4gPGEgc3R5bGU9ImNvbG9yOiByZWQ7IiBocmVmPSJodHRwczovL2dyZWFzeWZvcmsub3JnL3poLUNOL3NjcmlwdHMvNDIyNjE5LTExNSVFOCVCRCVBQyVFNSVBRCU5OCVFNSU4QSVBOSVFNiU4OSU4QnVpJUU0JUJDJTk4JUU1JThDJTk2JUU3JTg5JTg4djItMiIgdGFyZ2V0PSJfYmxhbmsiPjExNei9rOWtmOWKqeaJi3Vp5LyY5YyW54mIdjIuMjwvYT5gLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXkgOiBmYWxzZSwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEdNX3NldFZhbHVlKCJkYXRlIixteURhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCkpOwogICAgICAgICAgICAvL0dNX3NldFZhbHVlKCJ2ZXJzaW9uIix0aGlzVmVyc2lvbik7CiAgICAgICAgfQogICAgfQoKCiAgICAvL+ino+WGs+aPkOWPluaXtueahGFsZXJ05LiN6IO95YWo5bGP55qE6Zeu6aKYCiAgICBpZiAod2luZG93LnRvcCA9PT0gd2luZG93LnNlbGYpIHsKICAgICAgICAkKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHVwZGF0ZVRpcCgpOwoKICAgICAgICAgICAgdmFyICRpdGVtQ29udGVudCA9IG51bGw7CiAgICAgICAgICAgIHZhciAkZXJyb3JMaXN0ID0gbnVsbDsKICAgICAgICAgICAgdmFyIGdldFRhbXBsYXRlID0gaGVyZURvYyhnZXRUYW1wbGF0ZUxpbmVzKTsKCiAgICAgICAgICAgICQod2luZG93KS5vbigibWVzc2FnZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0YUluZm8gPSBKU09OLnBhcnNlKGUub3JpZ2luYWxFdmVudC5kYXRhKTsKICAgICAgICAgICAgICAgIGlmIChkYXRhSW5mby5ldmVudElEICE9ICIxMTVzaGExIiB8fCBlLm9yaWdpbmFsRXZlbnQub3JpZ2luICE9ICJodHRwczovLzExNS5jb20iKSByZXR1cm47CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGRhdGFJbmZvLmRhdGE7CgogICAgICAgICAgICAgICAgLy91aToKICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm1lc3NhZ2VUeXBlID09IE1lc3NhZ2VUeXBlLkJFR0lOKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmraPlnKjmk43kvZzkuK3vvIzor7fli7\/liIfmjaLor6XpobXpnaLku6XpmLLohJrmnKzkvJHnnKAuLi4nLAogICAgICAgICAgICAgICAgICAgICAgICBodG1sOiBnZXRUYW1wbGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleSA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBvbkJlZm9yZU9wZW46IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN3YWwuc2hvd0xvYWRpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkc3dhbENvbnRlbnQxID0gJChTd2FsLmdldENvbnRlbnQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXJyb3JMaXN0ID0gJHN3YWxDb250ZW50MS5maW5kKCIuZXJyb3JMaXN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbUNvbnRlbnQgPSAkc3dhbENvbnRlbnQxLmZpbmQoIi5pdGVtQ29udGVudCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlLm1lc3NhZ2VUeXBlID09IE1lc3NhZ2VUeXBlLlBST0NFU1NJTkcpIHsKICAgICAgICAgICAgICAgICAgICAkaXRlbUNvbnRlbnQuaHRtbChtZXNzYWdlLm1zZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlLm1lc3NhZ2VUeXBlID09IE1lc3NhZ2VUeXBlLkVSUk9SKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yTGlzdC5hcHBlbmQoJzxsaT48ZGl2IGRpc3BsYXk6IGZsZXg7Ij48cD4nICsgbWVzc2FnZS5tc2cgKyAnPC9wPjxwIHN0eWxlPSJmb250LXN0eWxlOiBpdGFsaWM7Ij48XHA+PFxkaXY+PFxsaT48bGk+PGhyLz48L2xpPicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobWVzc2FnZS5tZXNzYWdlVHlwZSA9PSBNZXNzYWdlVHlwZS5FTkQpIHsKICAgICAgICAgICAgICAgICAgICAkaXRlbUNvbnRlbnQuaHRtbChtZXNzYWdlLm1zZyk7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5nZXRUaXRsZSgpLnRleHRDb250ZW50ID0gIuaTjeS9nOWujOaIkO+8gSI7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5oaWRlTG9hZGluZygpOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1lc3NhZ2UubWVzc2FnZVR5cGUgPT0gTWVzc2FnZVR5cGUuQ0xPU0UpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CgoKCgoKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH0KCgoKCiAgICBmdW5jdGlvbiBkZWxheShtcykgewoKICAgICAgICBpZiAobXMgPT0gMCkgewogICAgICAgICAgICBtcyA9IDEwMDAgKiAoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDExIC0gNCkpICsgNCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKQogICAgfQoKCiAgICAvLyNyZWdpb24gMTE1IGFwaQogICAgLy9nZXQgICBVcGxvYWRJbmZvCiAgICAvL3JldHVybiB7c3RhdGU6ZmFsc2UsdXNlcl9pZDowLHVzZXJrZXk6JzAnLGVycm9yOicnfQogICAgYXN5bmMgZnVuY3Rpb24gZ2V0VXBsb2FkSW5mbygpIHsKICAgICAgICBjb25zdCByID0gYXdhaXQgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9wcm9hcGkuMTE1LmNvbS9hcHAvdXBsb2FkaW5mbycsCiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6IHRydWUgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByOwogICAgfQoKICAgIC8vYWRkIGEgZm9sZGVyCiAgICAvL3JldHVybiB7c3RhdGU6IGZhbHNlLCBlcnJvcjogIuivpeebruW9leWQjeensOW3suWtmOWcqOOAgiIsIGVycm5vOiAyMDAwNCwgZXJydHlwZTogIndhciJ9CiAgICAvL3JldHVybiB7c3RhdGU6IHRydWUsIGVycm9yOiAiIiwgZXJybm86ICIiLCBhaWQ6IDEsIGNpZDogIjIwMjA0NTUwNzgwMTA1MTE5NzUiLMKg4oCmfQogICAgYXN5bmMgZnVuY3Rpb24gYWRkRm9sZGVyKHBpZCwgZm9sZGVyTmFtZSkgewogICAgICAgIGNvbnN0IHBvc3REYXRhID0gUG9zdERhdGEoewogICAgICAgICAgICBwaWQ6IHBpZCwKICAgICAgICAgICAgY25hbWU6IGVuY29kZVVSSUNvbXBvbmVudChmb2xkZXJOYW1lKQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCByID0gYXdhaXQgJC5hamF4KHsKICAgICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgICB1cmw6ICdodHRwczovL3dlYmFwaS4xMTUuY29tL2ZpbGVzL2FkZCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0sCiAgICAgICAgICAgIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6IHRydWUgfSwKICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgZGF0YTogcG9zdERhdGEKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHI7CiAgICB9CgoKICAgIC8vcmV0dXJuIHtkYXRhOiBBcnJheSgzMCksIGNvdW50OiA1MywgZGF0YV9zb3VyY2U6ICJEQiIsIHN5c19jb3VudDogMCwgb2Zmc2V0OiAwLMKgcGFnZV9zaXplOjExNSwg4oCmfQogICAgLy9yZXR1cm4gQXJyYXkgdHlwZToKICAgIC8vICAgICAgW2ZvbGRlcl06e2NpZDogIiIsIGFpZDogIjEiLCBwaWQ6ICIiLCBuOiAiIiwgbTogMCwg4oCmfQogICAgLy8gICAgICBbZmlsZV06ICB7ZmlkOiAiIiwgdWlkOiAxNDQ3ODEyLCBhaWQ6IDEsIGNpZDogIiIsIG46ICIiLHBjOiIiLHNoYToiIixzOjAsdDoiIiDigKZ9CiAgICBhc3luYyBmdW5jdGlvbiBnZXREaXJlY3RDaGlsZEl0ZW1zQnlPZmZzZXQoY2lkLCBvZmZzZXQpIHsKICAgICAgICB2YXIgdFVybCA9ICdodHRwczovL3dlYmFwaS4xMTUuY29tL2ZpbGVzP2FpZD0xJmNpZD0nK2NpZCsnJm89ZmlsZV9uYW1lJmFzYz0xJm9mZnNldD0nK29mZnNldCsnJnNob3dfZGlyPTEmbGltaXQ9MTE1MCZjb2RlPSZzY2lkPSZzbmFwPTAmbmF0c29ydD0xJnJlY29yZF9vcGVuX3RpbWU9MSZzb3VyY2U9JmZvcm1hdD1qc29uJmZjX21peD0mdHlwZT0mc3Rhcj0maXNfc2hhcmU9JnN1ZmZpeD0mY3VzdG9tX29yZGVyPSc7CiAgICAgICAvLyB2YXIgdFVybCA9ICJodHRwczovL2Fwcy4xMTUuY29tL25hdHNvcnQvZmlsZXMucGhwP2FpZD0xJmNpZD0iICsgY2lkICsgIiZvPWZpbGVfbmFtZSZhc2M9MSZvZmZzZXQ9IiArIG9mZnNldCArICImc2hvd19kaXI9MSZsaW1pdD0xMTUwJmNvZGU9JnNjaWQ9JnNuYXA9MCZuYXRzb3J0PTEmcmVjb3JkX29wZW5fdGltZT0xJnNvdXJjZT0mZm9ybWF0PWpzb24mZmNfbWl4PTAmdHlwZT0mc3Rhcj0maXNfc2hhcmU9JnN1ZmZpeD0mY3VzdG9tX29yZGVyPSI7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgJC5hamF4KHsKICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgIHVybDogdFVybCwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogdHJ1ZSB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvL+ebtOaOpeWtkOmhueebruWwkeS6jjEyMDAKICAgIGFzeW5jIGZ1bmN0aW9uIGdldERpcmVjdENoaWxkSXRlbXNCeU9mZnNldGx0MTIwMChjaWQsIG9mZnNldCkgewogICAgICAgIC8vdmFyIHRVcmwgPSAnaHR0cHM6Ly93ZWJhcGkuMTE1LmNvbS9maWxlcz9haWQ9MSZjaWQ9JytjaWQrJyZvPWZpbGVfbmFtZSZhc2M9MSZvZmZzZXQ9JytvZmZzZXQrJyZzaG93X2Rpcj0xJmxpbWl0PTExNTAmY29kZT0mc2NpZD0mc25hcD0wJm5hdHNvcnQ9MSZyZWNvcmRfb3Blbl90aW1lPTEmc291cmNlPSZmb3JtYXQ9anNvbiZmY19taXg9JnR5cGU9JnN0YXI9JmlzX3NoYXJlPSZzdWZmaXg9JmN1c3RvbV9vcmRlcj0nOwogICAgICAgIHZhciB0VXJsID0gImh0dHBzOi8vYXBzLjExNS5jb20vbmF0c29ydC9maWxlcy5waHA\/YWlkPTEmY2lkPSIgKyBjaWQgKyAiJm89ZmlsZV9uYW1lJmFzYz0xJm9mZnNldD0iICsgb2Zmc2V0ICsgIiZzaG93X2Rpcj0xJmxpbWl0PTExNTAmY29kZT0mc2NpZD0mc25hcD0wJm5hdHNvcnQ9MSZyZWNvcmRfb3Blbl90aW1lPTEmc291cmNlPSZmb3JtYXQ9anNvbiZmY19taXg9MCZ0eXBlPSZzdGFyPSZpc19zaGFyZT0mc3VmZml4PSZjdXN0b21fb3JkZXI9IjsKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoewogICAgICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICAgICAgdXJsOiB0VXJsLAogICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiB0cnVlIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8vcmV0dXJuIEFsbERpcmVjdCBpdGVtcyA6e2lkOiIiLHBhcmVudElEOmNpZCxpc0ZvbGRlcjpmYWxzZSxuYW1lOiIiLHNpemU6MCxwYzoiIixzaGE6IiIscGF0aHNbXSB9OwogICAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsRGlyZWN0SXRlbXMoY2lkLCBmb2xkZXJQcm9jZXNzQ2FsbGJhY2spIHsKICAgICAgICB2YXIgaXRlbXMgPSBuZXcgQXJyYXkoKTsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHZhciBmbGFnID0gdHJ1ZTsKICAgICAgICB2YXIgcGFnZUluZGV4ID0gMTsKICAgICAgICB2YXIgZmlyc3Q9dHJ1ZTsKICAgICAgICB2YXIgaXNMVDEyMDA9ZmFsc2U7CgogICAgICAgIHdoaWxlIChmbGFnKSB7CiAgICAgICAgICAgIGZvbGRlclByb2Nlc3NDYWxsYmFjayhwYWdlSW5kZXgpOwogICAgICAgICAgICB2YXIgcmVzdWx0PW51bGw7CiAgICAgICAgICAgIC8vMTIwMOaVsOmHj++8jOS4jeWQjOeahGFwae+8m+i\/meS5iOWGmeWHj+WwkeWPkeWMhQogICAgICAgICAgICBpZihmaXJzdCl7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBnZXREaXJlY3RDaGlsZEl0ZW1zQnlPZmZzZXQoY2lkLCBpbmRleCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmlyc3QgPjEyMDAgOnswfSx7MX0iLmZvcm1hdChyZXN1bHQuc3RhdGUscmVzdWx0LmNvdW50KSk7CiAgICAgICAgICAgICAgICBpZighcmVzdWx0LnN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0PWF3YWl0IGdldERpcmVjdENoaWxkSXRlbXNCeU9mZnNldGx0MTIwMChjaWQsaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJmaXJzdCA8MTIwMCA6ezB9LHsxfSIuZm9ybWF0KHJlc3VsdC5zdGF0ZSxyZXN1bHQuY291bnQpKTsKICAgICAgICAgICAgICAgICAgICBpc0xUMTIwMD10cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmlyc3Q9ZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGlmKGlzTFQxMjAwKSByZXN1bHQ9YXdhaXQgZ2V0RGlyZWN0Q2hpbGRJdGVtc0J5T2Zmc2V0bHQxMjAwKGNpZCxpbmRleCk7CiAgICAgICAgICAgICAgICBlbHNlIHJlc3VsdCA9IGF3YWl0IGdldERpcmVjdENoaWxkSXRlbXNCeU9mZnNldChjaWQsIGluZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHRvdGFsQ291bnQ9cGFyc2VJbnQocmVzdWx0LmNvdW50KTsKICAgICAgICAgICAgaWYgKHRvdGFsQ291bnQgPj0gMSkgewogICAgICAgICAgICAgICAgcmVzdWx0LmRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIHZhciBwSXRlbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJRDogY2lkLAogICAgICAgICAgICAgICAgICAgICAgICBpc0ZvbGRlcjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGlja0NvZGU6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBzaGExOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHM6IG5ldyBBcnJheSgpLAogICAgICAgICAgICAgICAgICAgICAgICBwcmVpZDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRUb1JlbW92ZWQ6ZmFsc2UKICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5maWQpLy\/mlofku7YgZmlkLGNpZAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcEl0ZW0uaXNGb2xkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgcEl0ZW0uaWQgPSBpdGVtLmZpZDsKICAgICAgICAgICAgICAgICAgICAgICAgcEl0ZW0ubmFtZSA9IGl0ZW0ubjsKICAgICAgICAgICAgICAgICAgICAgICAgcEl0ZW0ucGlja0NvZGUgPSBpdGVtLnBjOwogICAgICAgICAgICAgICAgICAgICAgICBwSXRlbS5zaGExID0gaXRlbS5zaGE7CiAgICAgICAgICAgICAgICAgICAgICAgIHBJdGVtLnNpemUgPSBpdGVtLnM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgLy\/nm67lvZUgY2lkLHBpZAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcEl0ZW0uaXNGb2xkZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBwSXRlbS5pZCA9IGl0ZW0uY2lkOwogICAgICAgICAgICAgICAgICAgICAgICBwSXRlbS5uYW1lID0gaXRlbS5uOwogICAgICAgICAgICAgICAgICAgICAgICBwSXRlbS5waWNrQ29kZSA9IGl0ZW0ucGM7CiAgICAgICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1JbmRleD1pdGVtcy5maW5kSW5kZXgocT0+cS5uYW1lPT1wSXRlbS5uYW1lJiZxLnBpY2tDb2RlPT1wSXRlbS5waWNrQ29kZSYmcS5zaGExPT1wSXRlbS5zaGExJiYoXy5pc0VxdWFsKHEucGF0aHMscEl0ZW0ucGF0aHMpKSk7CiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbUluZGV4PT0tMSkgaXRlbXMucHVzaChwSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgLy\/lj6\/og73lrZjlnKjlkIzkuIDkuKrnm67lvZXkuIvvvIzkuKTkuKrmlofku7bkuIDmqKHkuIDmoLcsCiAgICAgICAgICAgICAgICAgICAgICAgIC8v55u45ZCM5paH5Lu25aSE55CG77ya5LiN54S25b6q546v5p2h5Lu26YCA5LiN5Ye6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vZml4OnBpY2tjb2Rl5LiN5LiA5qC3LOWFiOS\/neWtmOedgOWQpwogICAgICAgICAgICAgICAgICAgICAgICBwSXRlbS5uZWVkVG9SZW1vdmVkPXRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2gocEl0ZW0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc29sZS5sb2coIl9fX19fX19fX19fX19fX3RvdGFsQ291bnQgIit0b3RhbENvdW50KTsKICAgICAgICAgICAgY29uc29sZS5sb2coaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAvL+W9k+iOt+WPluWIsOavlHBhZ2VzaXpl5bCP5pe277yM6I635Y+W57uT5p2fLDEyMDDml7bmnInkuKrlnZHjgILjgILjgIIKICAgICAgICAgICAgaWYgKHRvdGFsQ291bnQgPD0gaXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGF5KDUwMCk7CiAgICAgICAgICAgICAgICBpbmRleCA9IGl0ZW1zLmxlbmd0aDsKICAgICAgICAgICAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleCArIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnNvbGUubG9nKCJjaWQ6IHswfSwgY291bnQ6IHsxfSIuZm9ybWF0KGNpZCwgaXRlbXMubGVuZ3RoKSk7CgogICAgICAgIHZhciBub051bGxJdGVtcz1pdGVtcy5maWx0ZXIocT0+IXEubmVlZFRvUmVtb3ZlZCk7CiAgICAgICAgY29uc29sZS5sb2coImNpZDogezB9LCDpmaTljrvlrozlhajph43lpI1jb3VudDogezF9Ii5mb3JtYXQoY2lkLCBub051bGxJdGVtcy5sZW5ndGgpKTsKCiAgICAgICAgcmV0dXJuIG5vTnVsbEl0ZW1zOwogICAgfQoKICAgIC8vcmV0dXJuIHtmaWxlX25hbWU6IiIscGlja19jb2RlOiIiLHNoYTE6IiIsY291bnQ6IiIsc2l6ZToiIixmb2xkZXJfY291bnQ6IiIscGF0aHM6W119CiAgICAvL3JldHVybiBwYXRoczpbXeWxgue6p+ebruW9lQogICAgYXN5bmMgZnVuY3Rpb24gZ2V0Rm9sZGVySW5mbyhjaWQpIHsKICAgICAgICB2YXIgcFVybCA9ICJodHRwczovL3dlYmFwaS4xMTUuY29tL2NhdGVnb3J5L2dldD9haWQ9MSZjaWQ9IiArIGNpZDsKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoewogICAgICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICAgICAgdXJsOiBwVXJsLAogICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiB0cnVlIH0KICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgIHZhciBwSXRlbSA9IHsKICAgICAgICAgICAgZmlsZUNvdW50OiBwYXJzZUludChyZXN1bHQuY291bnQpLAogICAgICAgICAgICBmb2xkZXJDb3VudDogcGFyc2VJbnQocmVzdWx0LmZvbGRlcl9jb3VudCksCiAgICAgICAgICAgIGlkOiBjaWQsCiAgICAgICAgICAgIHBhcmVudElEOiAiIiwKICAgICAgICAgICAgaXNGb2xkZXI6IHRydWUsCiAgICAgICAgICAgIG5hbWU6IHJlc3VsdC5maWxlX25hbWUsCiAgICAgICAgICAgIHNpemU6IHJlc3VsdC5zaXplLAogICAgICAgICAgICBwaWNrQ29kZTogcmVzdWx0LnBpY2tfY29kZSwKICAgICAgICAgICAgc2hhMTogIiIsCiAgICAgICAgICAgIHBhdGhzOiByZXN1bHQucGF0aHMsCiAgICAgICAgICAgIHByZWlkOiAiIgogICAgICAgIH07CgogICAgICAgIHJldHVybiBwSXRlbTsKICAgIH0KCiAgICAvLyBnZXQgZmlsZUFycmF5OntpZDoiIixwYXJlbnRJRDpjaWQsaXNGb2xkZXI6ZmFsc2UsbmFtZToiIixzaXplOjAscGM6IiIsc2hhOiIiLHBhdGhzW10gfTsKICAgIGFzeW5jIGZ1bmN0aW9uIGdldEFsbEZpbGVzKGNpZCwgZmlsZUFycmF5LCB0b3BDaWQsIGZvbGRlclByb2Nlc3NDYWxsYmFjaykgewogICAgICAgIHZhciB0aGlzRm9sZGVyID0gYXdhaXQgZ2V0Rm9sZGVySW5mbyhjaWQpOwogICAgICAgIGZvbGRlclByb2Nlc3NDYWxsYmFjayh0aGlzRm9sZGVyLm5hbWUsMCk7CiAgICAgICAgLy\/nqbrnm67lvZXvvIzot7Pov4fpgY3ljoYKICAgICAgICBpZiAodGhpc0ZvbGRlci5maWxlQ291bnQgPT0gMCkgcmV0dXJuOwogICAgICAgIGZvbGRlclByb2Nlc3NDYWxsYmFjayh0aGlzRm9sZGVyLm5hbWUpCiAgICAgICAgdmFyIGRpcmVjdEl0ZW1zID0gYXdhaXQgZ2V0QWxsRGlyZWN0SXRlbXModGhpc0ZvbGRlci5pZCwgcGFnZUluZGV4ID0+IHsKICAgICAgICAgICAgZm9sZGVyUHJvY2Vzc0NhbGxiYWNrKHRoaXNGb2xkZXIubmFtZSxwYWdlSW5kZXgpOwogICAgICAgIH0pOwogICAgICAgIC8v56m655uu5b2V77yM6Lez6L+H6YGN5Y6GCiAgICAgICAgaWYgKGRpcmVjdEl0ZW1zLmxlbmd0aCA9PSAwKSByZXR1cm47CiAgICAgICAgdmFyIGZpbGVzID0gZGlyZWN0SXRlbXMuZmlsdGVyKHQgPT4gIXQuaXNGb2xkZXIpOwogICAgICAgIGZpbGVzLmZvckVhY2goZiA9PiB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXNGb2xkZXIucGF0aHMuZmluZEluZGV4KHEgPT4gcS5maWxlX2lkLnRvU3RyaW5nKCkgPT0gdG9wQ2lkKTsKICAgICAgICAgICAgdmFyIHBhdGhzID0gbmV3IEFycmF5KCk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPSAtMSkgewogICAgICAgICAgICAgICAgcGF0aHMgPSB0aGlzRm9sZGVyLnBhdGhzLnNsaWNlKGluZGV4KS5tYXAocSA9PiBxLmZpbGVfbmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF0aHMucHVzaCh0aGlzRm9sZGVyLm5hbWUpOwogICAgICAgICAgICBmLnBhdGhzID0gcGF0aHMuc2xpY2UoMSk7CiAgICAgICAgICAgIGZpbGVBcnJheS5wdXNoKGYpOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgZm9sZGVycyA9IGRpcmVjdEl0ZW1zLmZpbHRlcih0ID0+IHQuaXNGb2xkZXIpOwogICAgICAgIGZvciAodmFyIGZvbGRlciBvZiBmb2xkZXJzKSB7CiAgICAgICAgICAgICBhd2FpdCBnZXRBbGxGaWxlcyhmb2xkZXIuaWQsIGZpbGVBcnJheSwgdG9wQ2lkLCBmb2xkZXJQcm9jZXNzQ2FsbGJhY2spOwogICAgICAgICAgICAgYXdhaXQgZGVsYXkoMjAwKTsKICAgICAgICB9CgogICAgfQoKICAgIC8v6I635Y+W55Sf5oiQc2hhMemcgOimgXByZWlkCiAgICAvL3JldHVybjoge3N0YXRlOixlcnJvcjosZmlsZUl0ZW06fQogICAgZnVuY3Rpb24gZ2V0RmlsZUl0ZW1QcmVpZChmaWxlSXRlbSkgewogICAgICAgIC8vY29uc29sZS5sb2coZmlsZUl0ZW0pOwogICAgICAgIGNvbnN0IGYgPSBmaWxlSXRlbTsKICAgICAgICBpZihmLnNpemU9PTB8fGYuc2l6ZT09IjAiKXsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCk9PgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvck1zZz0iezB9IOaWh+S7tuWkp+Wwj+S4ujDvvIzlt7Lnu4\/ot7Pov4fvvIEiLmZvcm1hdChmLmZpbGVuYW1lKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoImVycm9yTXNnIik7CiAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3RhdGU6IGZhbHNlLCBlcnJvcjogIuaWh+S7tuWkp+Wwj+S4ujDvvIzlt7Lnu4\/ot7Pov4fvvIEiLCBmaWxlSXRlbTogZmlsZUl0ZW0gfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL3Byb2FwaS4xMTUuY29tL2FwcC9jaHJvbWUvZG93bnVybCcsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJywnVXNlci1BZ2VudCc6J01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODMuMC40MTAzLjYxIFNhZmFyaS81MzcuMzYgMTE1QnJvd3Nlci8yMy45LjMuNicgfSwKICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgZGF0YTogUG9zdERhdGEoeyBkYXRhOiBtMTE1X2VuY29kZSgneyJwaWNrY29kZSI6IicgKyBmaWxlSXRlbS5waWNrQ29kZSArICcifScpIH0pLAogICAgICAgICAgICAgICAgb25sb2FkOiBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgICAgIGlmIChyLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkX2luZm8gPSByLnJlc3BvbnNlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkb3dubG9hZF9pbmZvKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZG93bmxvYWRfaW5mby5zdGF0ZSYmZG93bmxvYWRfaW5mby5kYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBtMTE1X2RlY29kZShkb3dubG9hZF9pbmZvLmRhdGEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBKU09OLnBhcnNlKGpzb24pW2ZpbGVJdGVtLmlkXVsndXJsJ11bJ3VybCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3AgPSByLnJlc3BvbnNlSGVhZGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNldENvb2tpZSA9IERlbGV0ZUNvb2tpZShyZXNwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVDb29raWUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNldENvb2tpZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVDb29raWUgPSBzZXRDb29raWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUmFuZ2UiOiAiYnl0ZXM9MC0xNTQxMTIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29va2llIjogZmlsZUNvb2tpZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOidNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgzLjAuNDEwMy42MSBTYWZhcmkvNTM3LjM2IDExNUJyb3dzZXIvMjMuOS4zLjYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25sb2FkOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJlX2J1ZmYgPSByZXNwb25zZS5yZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkocHJlX2J1ZmYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNoYTEgPSBuZXcganNTSEEoJ1NIQS0xJywgJ0FSUkFZQlVGRkVSJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGExLnVwZGF0ZShkYXRhLnNsaWNlKDAsIDEyOCAqIDEwMjQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmVpZCA9IHNoYTEuZ2V0SGFzaCgnSEVYJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFVwcGVyOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVJdGVtLnByZWlkID0gcHJlaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgc3RhdGU6IHRydWUsIGVycm9yOiAiIiwgZmlsZUl0ZW06IGZpbGVJdGVtIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZvcmJpZGRlbiwg5bey57uP55SoNDDkuKow5Luj5pu\/Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlSXRlbS5wcmVpZCA9ICIwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdGF0ZTogdHJ1ZSwgZXJyb3I6ICIiLCBmaWxlSXRlbTogZmlsZUl0ZW0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN0YXRlOiBmYWxzZSwgZXJyb3I6ICLlnKjmj5Dlj5bkuK3lj5HnlJ\/plJnor68uLi4iLCBmaWxlSXRlbTogZmlsZUl0ZW0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRvd25sb2FkX2luZm8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN0YXRlOiBmYWxzZSwgZXJyb3I6IGRvd25sb2FkX2luZm8ubXNnLCBmaWxlSXRlbTogZmlsZUl0ZW0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlc3BvbnNlLnJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN0YXRlOiBmYWxzZSwgZXJyb3I6ICLlnKjmj5Dlj5bkuK3lj5HnlJ\/plJnor68uLi4iLCBmaWxlSXRlbTogZmlsZUl0ZW0gfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcjsKICAgIH0KCiAgICAvL+agvOW8j+WMlnNoYTEg6ZO+5o6lCiAgICAvL3JldHVybiB0eXBlOiB7c3RhdGU6c3VjY2VlZCxtc2c6IiJ9CiAgICAvLyBmYWxzZTptc2ctPuWHuumUmeS\/oeaBrwogICAgLy90cnVlOiBtc2ctPnNoYTHpk77mjqUg77yM5bim55uu5b2VCiAgICBmdW5jdGlvbiBjb252ZXJ0VG9TaGExTGluayhmaWxlSXRlbSkgewogICAgICAgIHZhciBzdWNjZWVkID0gZmFsc2U7CiAgICAgICAgdmFyIG1zZyA9ICLmoLzlvI\/nlJ\/miJDlpLHotKUhIjsKICAgICAgICBpZiAoZmlsZUl0ZW0ubmFtZSAmJiBmaWxlSXRlbS5zaXplICYmIGZpbGVJdGVtLnNoYTEgJiYgZmlsZUl0ZW0ucHJlaWQpIHsKICAgICAgICAgICAgdmFyIHNoYTFMaW5rID0gIjExNTovLyIgKyBmaWxlSXRlbS5uYW1lICsgInwiICsgZmlsZUl0ZW0uc2l6ZSArICJ8IiArIGZpbGVJdGVtLnNoYTEgKyAifCIgKyBmaWxlSXRlbS5wcmVpZDsKCiAgICAgICAgICAgIGlmIChmaWxlSXRlbS5wYXRocy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhmaWxlSXRlbS5wYXRocyk7CgogICAgICAgICAgICAgICAgdmFyIHBhdGhzID0gZmlsZUl0ZW0ucGF0aHMuam9pbignfCcpOwogICAgICAgICAgICAgICAgbXNnID0gc2hhMUxpbmsgKyAnfCcgKyBwYXRoczsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1zZyA9IHNoYTFMaW5rCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN1Y2NlZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgc3RhdGU6IHN1Y2NlZWQsIG1zZzogbXNnIH07CiAgICB9CgogICAgLy8g5LuOc2hhMWxpbmsg6L2s5o2i5Li6IEZpbGVJdGVtCiAgICAvL3JldHVybiB0eXBlOntzdGF0ZTpzdWNjZWVkLGZpbGVJdGVtOnt9fQogICAgLy90cnVlOiBmaWxlSXRlbSwgZmFsc2U6bnVsbAogICAgZnVuY3Rpb24gY29udmVydEZyb21TaGExTGluayhzaGExTGluaykgewogICAgICAgIHZhciBzdWNjZWVkID0gZmFsc2U7CiAgICAgICAgdmFyIGl0ZW0gPSB7fTsKICAgICAgICBpZiAoc2hhMUxpbmspIHsKICAgICAgICAgICAgaWYgKHNoYTFMaW5rLnN0YXJ0c1dpdGgoIjExNTovLyIpKSB7CiAgICAgICAgICAgICAgICBzaGExTGluayA9IHNoYTFMaW5rLnN1YnN0cmluZyg2KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGluZm9zID0gc2hhMUxpbmsuc3BsaXQoJ3wnKTsKICAgICAgICAgICAgaWYgKGluZm9zLmxlbmd0aCA+PSA0KSB7CiAgICAgICAgICAgICAgICBpdGVtLm5hbWUgPSBpbmZvc1swXTsKICAgICAgICAgICAgICAgIGl0ZW0uc2l6ZSA9IGluZm9zWzFdOwogICAgICAgICAgICAgICAgaXRlbS5zaGExID0gaW5mb3NbMl07CiAgICAgICAgICAgICAgICBpdGVtLnByZWlkID0gaW5mb3NbM107CiAgICAgICAgICAgICAgICBpdGVtLnBhcmVudElEID0gIiI7CiAgICAgICAgICAgICAgICBpdGVtLnBhdGhzID0gbmV3IEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAoaW5mb3MubGVuZ3RoID4gNCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpbmZvcy5sZW5ndGggPT0gNSAmJiBpbmZvc1s0XS5pbmNsdWRlcygnIycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v5YW85a65ICPlrZfnrKbliIblibIKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXRocyA9IGluZm9zWzRdLnNwbGl0KCcjJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBhdGhzID0gaW5mb3Muc2xpY2UoNCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3VjY2VlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHN0YXRlOiBzdWNjZWVkLCBmaWxlSXRlbTogaXRlbSB9OwogICAgfQoKCiAgICBmdW5jdGlvbiBjcmVhdGVVcGxvYWRGaWxlKHVybERhdGEsIHBvc3REYXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vdXBsYi4xMTUuY29tLzMuMC9pbml0dXBsb2FkLnBocD8nICsgdXJsRGF0YSwKICAgICAgICAgICAgICAgIGRhdGE6IHBvc3REYXRhLAogICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0geyBzdGF0ZTogZmFsc2UsIGVycm9yOiAiIiB9OwogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJiByZXNwb25zZS5yZXNwb25zZS5zdGF0dXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3I9cmVzcG9uc2UucmVzcG9uc2Uuc3RhdHVzbXNnPyIgIityZXNwb25zZS5yZXNwb25zZS5zdGF0dXNtc2c6IiDmiJborrhzaGEx6ZO+5o6l5LiN5Yy56YWNPyI7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IgPSBlcnJvcjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCgogICAgICAgIH0pOwogICAgfQoKICAgIC8vcmV0dXJuOntzdGF0ZTpmYWxzZSxlcnJvcjoiIixmaWxlSXRlbTp9OwogICAgZnVuY3Rpb24gdXBsb2FkRmlsZSh0YXJnZXRGb2xkZXIsIGZpbGVJdGVtLCB1cGxvYWRJbmZvKSB7CgogICAgICAgIHZhciBmQ2lkID0gJ1VfMV97MH0nLmZvcm1hdCh0YXJnZXRGb2xkZXIpOwogICAgICAgIHZhciBhcHBWZXJzaW9uID0gIjI1LjIuMCI7CgogICAgICAgIHZhciB1cmxEYXRhID0gVXJsRGF0YSh7CiAgICAgICAgICAgIGlzcDogMCwKICAgICAgICAgICAgYXBwaWQ6IDAsCiAgICAgICAgICAgIGFwcHZlcnNpb246IGFwcFZlcnNpb24sCiAgICAgICAgICAgIGZvcm1hdDogJ2pzb24nLAogICAgICAgICAgICBzaWc6IEdldFNpZyh1cGxvYWRJbmZvLnVzZXJfaWQsIGZpbGVJdGVtLnNoYTEsIGZDaWQsIHVwbG9hZEluZm8udXNlcmtleSkKICAgICAgICB9KTsKCgogICAgICAgIHZhciBwb3N0RGF0YSA9IFBvc3REYXRhKHsKICAgICAgICAgICAgcHJlaWQ6IGZpbGVJdGVtLnByZWlkLAogICAgICAgICAgICBmaWxlaWQ6IGZpbGVJdGVtLnNoYTEsCiAgICAgICAgICAgIHF1aWNraWQ6IGZpbGVJdGVtLnNoYTEsCiAgICAgICAgICAgIGFwcF92ZXI6IGFwcFZlcnNpb24sCiAgICAgICAgICAgIGZpbGVuYW1lOiBlbmNvZGVVUklDb21wb25lbnQoZmlsZUl0ZW0ubmFtZSksCiAgICAgICAgICAgIGZpbGVzaXplOiBmaWxlSXRlbS5zaXplLAogICAgICAgICAgICBleGlmOiAnJywKICAgICAgICAgICAgdGFyZ2V0OiBmQ2lkLAogICAgICAgICAgICB1c2VyaWQ6IHVwbG9hZEluZm8udXNlcl9pZAoKICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgciA9IGNyZWF0ZVVwbG9hZEZpbGUodXJsRGF0YSwgcG9zdERhdGEpOwoKICAgICAgICBjb25zdCB4ID0gci50aGVuKHQgPT4gewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgICBmaWxlSXRlbS5zdGF0ZSA9IHQuc3RhdGU7CiAgICAgICAgICAgICAgICByZXNvbGUoeyBzdGF0ZTogdC5zdGF0ZSwgZXJyb3I6IHQuZXJyb3IsIGZpbGVJdGVtOiBmaWxlSXRlbSB9KTsKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHg7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TGlzdFZpZXcoKSB7CiAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly8xMTUuY29tLz9jdD11c2VyX3NldHRpbmcmYWM9c2V0JywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRhdGE6IFBvc3REYXRhKHsKICAgICAgICAgICAgICAgIHNldHRpbmc6ICd7InZpZXdfZmlsZSI6Imxpc3QifScKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvLyNlbmRyZWdpb24KCgoKICAgIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVBhcmVudElEKGNpZCwgY25hbWUsIHRoaXNMZXZlbCwgbWF4TGV2ZWwsIGl0ZW1zLCBjcmVhdGVGb2xkZXJDYWxsYmFjaykgewogICAgICAgIGlmICh0aGlzTGV2ZWwgPT0gbWF4TGV2ZWwpIHJldHVybjsKICAgICAgICB2YXIgZmlsZXMgPSBuZXcgQXJyYXkoKTsKICAgICAgICBpZiAodGhpc0xldmVsID09IDApIHsKICAgICAgICAgICAgZmlsZXMgPSBpdGVtczsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZpbGVzID0gaXRlbXMuZmlsdGVyKGYgPT4gZi5wYXRoc1t0aGlzTGV2ZWwgLSAxXSA9PSBjbmFtZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hpbGRGaWxlcyA9IGZpbGVzLmZpbHRlcihxID0+IHEucGF0aHMubGVuZ3RoID09IHRoaXNMZXZlbCk7CiAgICAgICAgdmFyIGNoaWxkRm9sZGVyTmFtZXMgPSBmaWxlcy5tYXAocSA9PiBxLnBhdGhzW3RoaXNMZXZlbF0pLmZpbHRlcihxID0+IHEpLmZpbHRlcigoeCwgaSwgYSkgPT4gYS5pbmRleE9mKHgpID09IGkpCgogICAgICAgIC8vdXBsb2FkIGZpbGU6CiAgICAgICAgZm9yICh2YXIgZmlsZSBvZiBjaGlsZEZpbGVzKSB7CiAgICAgICAgICAgIGZpbGUucGFyZW50SUQgPSBjaWQ7CiAgICAgICAgfQoKICAgICAgICAvL2NyZWF0ZSBmb2xkZXI6CiAgICAgICAgZm9yICh2YXIgZm9sZGVyTmFtZSBvZiBjaGlsZEZvbGRlck5hbWVzKSB7CiAgICAgICAgICAgIHZhciByID0gYXdhaXQgYWRkRm9sZGVyKGNpZCwgZm9sZGVyTmFtZSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHIpOwogICAgICAgICAgICB2YXIgdCA9IHsgc3RhdGU6IHIuc3RhdGUsIGZvbGRlck5hbWU6IGZvbGRlck5hbWUgLGVycm9yOnIuZXJyb3J9OwogICAgICAgICAgICBjcmVhdGVGb2xkZXJDYWxsYmFjayh0KTsKICAgICAgICAgICAgaWYgKHIuc3RhdGUpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVBhcmVudElEKHIuY2lkLCBmb2xkZXJOYW1lLCB0aGlzTGV2ZWwgKyAxLCBtYXhMZXZlbCwgZmlsZXMsIGNyZWF0ZUZvbGRlckNhbGxiYWNrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsvL3VpIOebruW9leWIm+W7uuWksei0pSAgdG9kbzoKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIuebruW9lSB7MH0g5Yib5bu65aSx6LSlIi5mb3JtYXQoZm9sZGVyTmFtZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGF3YWl0IGRlbGF5KDIwMCk7CiAgICAgICAgfQoKICAgIH0KCiAgICBmdW5jdGlvbiBpbnRlcm5lbEZvcm1hdChmb2xkZXIsIGZpbGVzLCBmb2xkZXJQYXJlbnRzKSB7CiAgICAgICAgdmFyIHBhdGhzID0gZm9sZGVyUGFyZW50cy5zbGljZSgwKTsKICAgICAgICBwYXRocy5wdXNoKGZvbGRlci5kaXJfbmFtZSk7CgogICAgICAgIGZvciAodmFyIGZpbGUgb2YgZm9sZGVyLmZpbGVzKSB7CgogICAgICAgICAgICB2YXIgbGluayA9IGZpbGUgKyAnfCcgKyBwYXRocy5zbGljZSgxKS5qb2luKCd8Jyk7CiAgICAgICAgICAgIGZpbGVzLnB1c2gobGluayk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBjaGlsZEZvbGRlciBvZiBmb2xkZXIuZGlycykgewoKICAgICAgICAgICAgaW50ZXJuZWxGb3JtYXQoY2hpbGRGb2xkZXIsIGZpbGVzLCBwYXRocykKICAgICAgICB9CiAgICB9CgogICAgLy97c3RhdGU6dHJ1ZSxlcnJvcjoiIix0ZXh0OiIifQogICAgZnVuY3Rpb24gZm9ybWF0SnNvblRvQ29tbW9uKHRleHQpIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHJvb3QgPSBKU09OLnBhcnNlKHRleHQpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhyb290KTsKICAgICAgICAgICAgdmFyIGZpbGVzID0gbmV3IEFycmF5KCk7CiAgICAgICAgICAgIHZhciBwYXRocyA9IG5ldyBBcnJheSgpOwogICAgICAgICAgICBpbnRlcm5lbEZvcm1hdChyb290LCBmaWxlcywgcGF0aHMpOwogICAgICAgICAgICByZXR1cm4geyBzdGF0ZTogdHJ1ZSwgZXJyb3I6ICIiLCB0ZXh0OiBmaWxlcy5qb2luKCdcclxuJykgfTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiB7IHN0YXRlOiBmYWxzZSwgZXJyb3I6IGVycm9yLCB0ZXh0OiAiIiB9OwogICAgICAgIH0KCiAgICB9CgoKICAgIGFzeW5jIGZ1bmN0aW9uIEJ5Q29tbW9uRm90bWF0KGZvbGRlckNpZCwgdGV4dCxuZWVkVG9DcmVhdGVQYXJlbnRGb2xkZXIpIHsKCiAgICAgICAgLy9qcyDlpYfmgKrnmoRcclxu5YiG5YmyLi4uCiAgICAgICAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCgvXHI\/XG4vKTsKCiAgICAgICAgdmFyIGZpbGVzID0gbmV3IEFycmF5KCk7CiAgICAgICAgdmFyIG1zZyA9ICIiOwogICAgICAgIHBvc3RTaGExTWVzc2dhZShjcmVhdGVNZXNzYWdlKE1lc3NhZ2VUeXBlLlBST0NFU1NJTkcsICLmraPlnKjop6PmnpDpk77mjqUuLi4iKSk7CiAgICAgICAgZm9yICh2YXIgbGluZSBvZiBsaW5lcykgewogICAgICAgICAgICB2YXIgZkxpbmUgPSBsaW5lLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFsaW5lKSBjb250aW51ZTsKCiAgICAgICAgICAgIHZhciByID0gY29udmVydEZyb21TaGExTGluayhsaW5lLnRyaW0oKSkKICAgICAgICAgICAgaWYgKHIuc3RhdGUpIHsKICAgICAgICAgICAgICAgIGZpbGVzLnB1c2goci5maWxlSXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5FUlJPUiwgInswfSDmoLzlvI\/plJnor68\/Ii5mb3JtYXQoZkxpbmUpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG1zZz0i6I635Y+W5Yiw6ZO+5o6l5Liq5pWw77yaezB9Ii5mb3JtYXQoZmlsZXMubGVuZ3RoKTsKICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5QUk9DRVNTSU5HLCBtc2cpKTsKICAgICAgICBhd2FpdCBkZWxheSgyMDApOwoKICAgICAgICB2YXIgcm9vdCA9IHsgbmFtZTogIiIsIGl0ZW1zOiBuZXcgQXJyYXkoKSB9OwogICAgICAgIC8v5pyA5aSn55qE5bGC5qyhCiAgICAgICAgdmFyIG1heExldmVsID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgZmlsZXMubWFwKGUgPT4gZS5sZW5ndGgpKTsKICAgICAgICB2YXIgbGV2ZWwgPSAwOwogICAgICAgIHZhciB1cGxvYWRJbmZvID0gYXdhaXQgZ2V0VXBsb2FkSW5mbygpOwogICAgICAgIC8vY2lk6I635Y+WCgogICAgICAgIGlmKG5lZWRUb0NyZWF0ZVBhcmVudEZvbGRlcil7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVBhcmVudElEKGZvbGRlckNpZCwgIiIsIGxldmVsLCBtYXhMZXZlbCwgZmlsZXMsIHQgPT4gewogICAgICAgICAgICAgICAgdmFyIHN0ID0gdC5zdGF0ZSA\/ICLmiJDlip8uIiA6ICLlpLHotKXvvIHvvIHvvIEgIit0LmVycm9yOwogICAgICAgICAgICAgICAgbXNnID0gIuWIm+W7uuebruW9lSA8Yj57MH08L2I+IHsxfSIuZm9ybWF0KHQuZm9sZGVyTmFtZSwgc3QpOwogICAgICAgICAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgbXNnKSk7CiAgICAgICAgICAgICAgICBpZighdC5zdGF0ZSkgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuRVJST1IsIG1zZykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IDE7CiAgICAgICAgdmFyIHByb21pc0FycmF5ID0gbmV3IEFycmF5KCk7CiAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgIuW8gOWni+i9rOWtmC4uLiIpKTsKICAgICAgICBmb3IgKHZhciBmaWxlIG9mIGZpbGVzKSB7CiAgICAgICAgICAgIHZhciBjaWQgPSBmaWxlLnBhcmVudElEID8gZmlsZS5wYXJlbnRJRCA6IGZvbGRlckNpZDsKICAgICAgICAgICAgdmFyIHIgPSB1cGxvYWRGaWxlKGNpZCwgZmlsZSwgdXBsb2FkSW5mbyk7CiAgICAgICAgICAgIHIudGhlbih0ID0+IHsKICAgICAgICAgICAgICAgIGlmICh0LnN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgbXNnID0gJzxkaXYgYWxpZ249InJpZ2h0Ij48Yj57MH08L2I+IHwgPGI+ezF9PC9iPjwvZGl2Pjxocj7jgJAgPGI+ezJ9PC9iPiDjgJHkuIrkvKDmiJDlip8uJy5mb3JtYXQoY29tcGxldGVkLCBmaWxlcy5sZW5ndGgsIHQuZmlsZUl0ZW0ubmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmVycm9yPSLjgJAgPGI+ezB9PC9iPiDjgJHkuIrkvKDlpLHotKUhISEgezF9Ii5mb3JtYXQodC5maWxlSXRlbS5uYW1lLCB0LmVycm9yKTsKICAgICAgICAgICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5FUlJPUiwgZmVycm9yKSk7CiAgICAgICAgICAgICAgICAgICAgbXNnID0gJzxkaXYgYWxpZ249InJpZ2h0Ij48Yj57MH08L2I+IHwgPGI+ezF9PC9iPjwvZGl2Pjxocj57Mn0nLmZvcm1hdChjb21wbGV0ZWQsIGZpbGVzLmxlbmd0aCxmZXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgbXNnKSk7CiAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSBjb21wbGV0ZWQgKyAxOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHByb21pc0FycmF5LnB1c2gocik7CiAgICAgICAgICAgIC8vIGlmIChpbmRleCAlIHdvcmtpbmdOdW1iZXJzID09IDApIHsKICAgICAgICAgICAgLy8gICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc0FycmF5KTsKICAgICAgICAgICAgLy8gICAgIGF3YWl0IGRlbGF5KDUwMCk7CiAgICAgICAgICAgIC8vICAgICBwcm9taXNBcnJheSA9IG5ldyBBcnJheSgpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGVsc2UgeyBhd2FpdCBkZWxheSgxMDApOyB9CiAgICAgICAgICAgIGlmIChpbmRleCAlIHdvcmtpbmdOdW1iZXJzID09IDApewogICAgICAgICAgICAgICAgYXdhaXQgZGVsYXkoNTAwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5kZXggPSBpbmRleCArIDE7CgogICAgICAgIH0KCiAgICAgICAgYXdhaXQgZGVsYXkoNTAwKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNBcnJheSk7CgogICAgICAgIHZhciBmYWlscyA9IGZpbGVzLmZpbHRlcihxID0+ICFxLnN0YXRlKTsKICAgICAgICB2YXIgZmFpbFRleHQgPSBmYWlscy5tYXAoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgdmFyIHIgPSBjb252ZXJ0VG9TaGExTGluayhwKTsKICAgICAgICAgICAgcmV0dXJuIHIubXNnOwogICAgICAgIH0pLmpvaW4oIlxyXG4iKTsKCiAgICAgICAgaWYgKGZhaWxUZXh0KSBHTV9zZXRDbGlwYm9hcmQoZmFpbFRleHQpOwoKCiAgICAgICAgbXNnID0gJ+WujOaIkOS4iuS8oO+8geaIkOWKnyA8Yj57MH08L2I+IO+8jOWksei0pSA8Yj57MX08L2I+IO+8jOWmguaenOacieWksei0pe+8jOW3suWwhuWksei0pXNoYTHpk77mjqXlpI3liLbliLDliarotLTmnb\/vvIHlpoLmnpzovazlrZjlpLHotKXvvIzor7fmo4Dmn6VzaGEx6ZO+5o6l5qC85byP5oiW6ICF5ZyoIGNocm9tZSDkuIrlsJ3or5XovazlrZjjgILojrflj5bmnIDmlrDniYjvvIzmiJbogIXpgYfliLDpl67popjljrvmraTlj43ppojvvIzmhJ\/osKIgIeeCueWHuy0+IDxhIGhyZWY9Imh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvemgtQ04vc2NyaXB0cy80MjI2MTktMTE1JUU4JUJEJUFDJUU1JUFEJTk4JUU1JThBJUE5JUU2JTg5JThCdWklRTQlQkMlOTglRTUlOEMlOTYlRTclODklODh2Mi0yIiB0YXJnZXQ9Il9ibGFuayI+MTE16L2s5a2Y5Yqp5omLdWnkvJjljJbniYh2Mi4yPC9hPicuZm9ybWF0KGZpbGVzLmxlbmd0aCAtIGZhaWxzLmxlbmd0aCwgZmFpbHMubGVuZ3RoKTsKICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5FTkQsIG1zZykpOwogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIE5ld0Rvd25sb2FkRmlsZUZyb21TaGExTGlua3MoZm9sZGVyQ2lkLCB0ZXh0LG5lZWRUb0NyZWF0ZVBhcmVudEZvbGRlcikgewogICAgICAgIGlmICghdGV4dCkgcmV0dXJuOwoKICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5CRUdJTiwgIuato+WcqOino+aekHNoYTHpk77mjqUuLi4iKSk7CiAgICAgICAgLy9qc29u5qC85byPCiAgICAgICAgaWYgKHRleHQuc3RhcnRzV2l0aCgneycpICYmIHRleHQuZW5kc1dpdGgoJ30nKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiSlNPTiIpOwogICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5QUk9DRVNTSU5HLCAi5q2j5Zyo6L2s5o2ianNvbuagvOW8jy4uLiIpKTsKICAgICAgICAgICAgdmFyIHIgPSBmb3JtYXRKc29uVG9Db21tb24odGV4dCk7CiAgICAgICAgICAgIGlmIChyLnN0YXRlKSB7CiAgICAgICAgICAgICAgICBhd2FpdCBCeUNvbW1vbkZvdG1hdChmb2xkZXJDaWQsIHIudGV4dCxuZWVkVG9DcmVhdGVQYXJlbnRGb2xkZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuRU5ELCAiSnNvbiDmoLzlvI\/op6PmnpDlh7rplJnvvIEiKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8v5pmu6YCa5qC85byPCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDT01NT04iKTsKICAgICAgICAgICAgYXdhaXQgQnlDb21tb25Gb3RtYXQoZm9sZGVyQ2lkLCB0ZXh0LG5lZWRUb0NyZWF0ZVBhcmVudEZvbGRlcik7CiAgICAgICAgfQoKCgogICAgfQoKCgoKCiAgICBmdW5jdGlvbiBHZXRGaWxlSXRlbUJ5bGlOb2RlKGxpTm9kZSkgewoKICAgICAgICB2YXIgcEl0ZW0gPSB7CiAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgcGFyZW50SUQ6ICIiLAogICAgICAgICAgICBpc0ZvbGRlcjogZmFsc2UsCiAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICBzaXplOiAwLAogICAgICAgICAgICBwaWNrQ29kZTogIiIsCiAgICAgICAgICAgIHNoYTE6ICIiLAogICAgICAgICAgICBwYXRoczogW10sCiAgICAgICAgICAgIHByZWlkOiAiIiwKICAgICAgICAgICAgc2VsZWN0ZWQ6ZmFsc2UKCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHR5cGUgPSBsaU5vZGUuZ2V0QXR0cmlidXRlKCJmaWxlX3R5cGUiKTsKICAgICAgICBwSXRlbS5uYW1lID0gbGlOb2RlLmdldEF0dHJpYnV0ZSgndGl0bGUnKTsKICAgICAgICBwSXRlbS5wYXJlbnRJRCA9IGxpTm9kZS5nZXRBdHRyaWJ1dGUoJ3BfaWQnKTsKICAgICAgICAKICAgICAgICB2YXIgaXNTZWxlY3RlZD1saU5vZGUuZ2V0QXR0cmlidXRlKCdjbGFzcycpOwogICAgICAgIGlmKGlzU2VsZWN0ZWQ9PSJzZWxlY3RlZCIpICBwSXRlbS5zZWxlY3RlZD10cnVlOwoKICAgICAgICBpZiAodHlwZSA9PSAiMCIpIHsKICAgICAgICAgICAgcEl0ZW0uaWQgPSBsaU5vZGUuZ2V0QXR0cmlidXRlKCdjYXRlX2lkJyk7CiAgICAgICAgICAgIHBJdGVtLmlzRm9sZGVyID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHBJdGVtLnNpemUgPSBsaU5vZGUuZ2V0QXR0cmlidXRlKCdmaWxlX3NpemUnKTsKICAgICAgICAgICAgcEl0ZW0uc2hhMSA9IGxpTm9kZS5nZXRBdHRyaWJ1dGUoJ3NoYTEnKTsKICAgICAgICAgICAgcEl0ZW0ucGlja0NvZGUgPSBsaU5vZGUuZ2V0QXR0cmlidXRlKCdwaWNrX2NvZGUnKTsKICAgICAgICAgICAgcEl0ZW0uaWQgPSBsaU5vZGUuZ2V0QXR0cmlidXRlKCdmaWxlX2lkJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcEl0ZW07CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gSW5uZXJDcmVhdGVTaGExTGlua3MoZmlsZXMsdHh0TmFtZSl7CiAgICAgICAgdmFyIG1zZz0iIjsKICAgICAgICB2YXIgaW5kZXggPSAxOwogICAgICAgIHZhciBjb21wbGV0ZWRJbmRleCA9IDE7CiAgICAgICAgdmFyIHByb21pc0FycmF5ID0gbmV3IEFycmF5KCk7CgogICAgICAgIHZhciBndDEyMDBmaWxlcz1maWxlcy5sZW5ndGg+PTEyMDA7CiAgICAgICAgY29uc29sZS5sb2coIj49MTIwMDogezB9Ii5mb3JtYXQoZ3QxMjAwZmlsZXMpKTsKCiAgICAgICAgZm9yICh2YXIgZmlsZSBvZiBmaWxlcykgewogICAgICAgICAgICBjb25zdCBmID0gZmlsZTsKICAgICAgICAgICAgY29uc3QgciA9IGdldEZpbGVJdGVtUHJlaWQoZik7CiAgICAgICAgICAgIHIudGhlbigodCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHQuc3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICBtc2cgPSAnPGRpdiBhbGlnbj0icmlnaHQiPjxiPnswfTwvYj4gfCA8Yj57MX08L2I+PC9kaXY+PGhyPuiOt+WPluOAkCA8Yj57Mn08L2I+IOOAkeeahHNoYTHpk77mjqXmiJDlip8nLmZvcm1hdChjb21wbGV0ZWRJbmRleCwgZmlsZXMubGVuZ3RoLCB0LmZpbGVJdGVtLm5hbWUpOwogICAgICAgICAgICAgICAgICAgIHBvc3RTaGExTWVzc2dhZShjcmVhdGVNZXNzYWdlKE1lc3NhZ2VUeXBlLlBST0NFU1NJTkcsIG1zZykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtc2cgPSAnPGRpdiBhbGlnbj0icmlnaHQiPjxiPnswfTwvYj4gfCA8Yj57MX08L2I+PC9kaXY+PGhyPuiOt+WPluOAkCA8Yj57Mn08L2I+IOOAkeeahHNoYTHpk77mjqXlpLHotKXvvIF7M30nLmZvcm1hdChjb21wbGV0ZWRJbmRleCwgZmlsZXMubGVuZ3RoLCB0LmZpbGVJdGVtLm5hbWUsdC5lcnJvcik7CiAgICAgICAgICAgICAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgbXNnKSkKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVBhdGggPSB0LmZpbGVJdGVtLnBhdGhzLmpvaW4oIiA+ICIpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpbGVQYXRoKTsKICAgICAgICAgICAgICAgICAgICBpZihmaWxlUGF0aCkgbXNnPSJ7MH0s5Y6f5Zug77yaezF9LOi3r+W+hO+8mnsyfSIuZm9ybWF0KHQuZmlsZUl0ZW0ubmFtZSwgdC5lcnJvcixmaWxlUGF0aCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBtc2c9InswfSzljp\/lm6DvvJp7MX0iLmZvcm1hdCh0LmZpbGVJdGVtLm5hbWUsIHQuZXJyb3IpOwoKICAgICAgICAgICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5FUlJPUixtc2cpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbXBsZXRlZEluZGV4ID0gY29tcGxldGVkSW5kZXggKyAxOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHByb21pc0FycmF5LnB1c2gocik7CgogICAgICAgICAgICAvL+iHquW3seaUueS7o+eggeWQp++8jOaAjuS5iOW8hOaPkOWPlumAu+i+keOAguOAguWkquaFou+8jOiAl+aXtumVv++8m+WkquW\/q++8jDExNeWuueaYk+ayoeWPjeW6lAogICAgICAgICAgICBpZihndDEyMDBmaWxlcyl7CiAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICUgd29ya2luZ051bWJlcnMgPT0gMCkgewogICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzQXJyYXkpOwogICAgICAgICAgICAgICAgYXdhaXQgZGVsYXkoMTAwMCk7CiAgICAgICAgICAgICAgICBwcm9taXNBcnJheSA9IG5ldyBBcnJheSgpOwogICAgICAgICAgICB9fQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgaWYgKGluZGV4ICUgd29ya2luZ051bWJlcnMgPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsYXkoMTUwMCk7CiAgICAgICAgICAgIH19CgogICAgICAgICAgICAvLwogICAgICAgICAgICBpbmRleCA9IGluZGV4ICsgMTsKICAgICAgICB9CgogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc0FycmF5KTsKCiAgICAgICAgdmFyIHN1Y2NlZWRBcnJheSA9IGZpbGVzLmZpbHRlcihxID0+IHEucHJlaWQpOwogICAgICAgIGlmIChzdWNjZWVkQXJyYXkubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGNvbnZlcnRUb1NoYTFMaW5rKHN1Y2NlZWRBcnJheVswXSk7CiAgICAgICAgICAgIHBvc3RTaGExTWVzc2dhZShjcmVhdGVNZXNzYWdlKE1lc3NhZ2VUeXBlLkNMT1NFLCAiIikpOwoKICAgICAgICAgICAgc2V0VGltZW91dChzID0+IHsKICAgICAgICAgICAgICAgIHByb21wdCgi5aSN5Yi25YiG5Lqr6ZO+5o6l5Yiw5Ymq6LS05p2\/Iiwgcyk7CiAgICAgICAgICAgIH0sIDEwMCwgcmVzdWx0Lm1zZyk7CgogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIHRleHQgPSBzdWNjZWVkQXJyYXkubWFwKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IGNvbnZlcnRUb1NoYTFMaW5rKHApOwogICAgICAgICAgICAgICAgcmV0dXJuIHIubXNnOwogICAgICAgICAgICB9KS5qb2luKCJcclxuIik7CgogICAgICAgICAgICBpZiAoc3VjY2VlZEFycmF5Lmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHZhciBmaWxlX25hbWUgPSB0eHROYW1lICsgIl9zaGExLnR4dCI7CiAgICAgICAgICAgICAgICBkb3dubG9hZChmaWxlX25hbWUsIHRleHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtc2cgPSAn5a6M5oiQ44CQIDxiPnswfTwvYj4g44CR5o+Q5Y+W77yB5oiQ5YqfIDxiPnsxfTwvYj4g77yM5aSx6LSlIDxiPnsyfTwvYj4gLuiOt+WPluacgOaWsOeJiO+8jOaIluiAhemBh+WIsOmXrumimOWOu+atpOWPjemmiO+8jOaEn+iwoiAh54K55Ye7LT4gPGEgaHJlZj0iaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy96aC1DTi9zY3JpcHRzLzQyMjYxOS0xMTUlRTglQkQlQUMlRTUlQUQlOTglRTUlOEElQTklRTYlODklOEJ1aSVFNCVCQyU5OCVFNSU4QyU5NiVFNyU4OSU4OHYyLTIiIHRhcmdldD0iX2JsYW5rIj4xMTXovazlrZjliqnmiYt1aeS8mOWMlueJiHYyLjI8L2E+Jy5mb3JtYXQodHh0TmFtZSwgc3VjY2VlZEFycmF5Lmxlbmd0aCwgZmlsZXMubGVuZ3RoIC0gc3VjY2VlZEFycmF5Lmxlbmd0aCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1zZyk7CiAgICAgICAgICAgIHBvc3RTaGExTWVzc2dhZShjcmVhdGVNZXNzYWdlKE1lc3NhZ2VUeXBlLkVORCwgbXNnKSk7CiAgICAgICAgfQogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIENyZWF0ZVNoYTFMaW5rcyhpdGVtKSB7CiAgICAgICAgLy91aTog6I635Y+W5paH5Lu25LitLi4uCiAgICAgICAgdmFyIG1zZyA9ICLmraPlnKjojrflj5bmlofku7YuLi4iOwogICAgICAgIHBvc3RTaGExTWVzc2dhZShjcmVhdGVNZXNzYWdlKE1lc3NhZ2VUeXBlLkJFR0lOLCBtc2cpKTsKICAgICAgICB2YXIgZmlsZXMgPSBuZXcgQXJyYXkoKTsKCiAgICAgICAgaWYgKCFpdGVtLmlzRm9sZGVyKSB7CiAgICAgICAgICAgIGZpbGVzLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBtc2cgPSAi5q2j5Zyo6I635Y+WIHswfSDkuIvnmoTlhoXlrrkuLi4iLmZvcm1hdChpdGVtLm5hbWUpOwogICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5QUk9DRVNTSU5HLCBtc2cpKTsKCiAgICAgICAgICAgIGF3YWl0IGdldEFsbEZpbGVzKGl0ZW0uaWQsIGZpbGVzLCBpdGVtLmlkLCAoZm5hbWUscEluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpZihwSW5kZXg+MSl7CiAgICAgICAgICAgICAgICAgICAgbXNnID0gIuato+WcqOiOt+WPliDjgJB7MH3jgJEg5LiL56ysIHsxfSDpobXnmoTlhoXlrrkuLi4iLmZvcm1hdChmbmFtZSxwSW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBtc2cgPSAi5q2j5Zyo6I635Y+WIOOAkHswfeOAkSDkuIvnmoTlhoXlrrkuLi4iLmZvcm1hdChmbmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5QUk9DRVNTSU5HLCBtc2cpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIWZpbGVzIHx8IGZpbGVzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5FTkQsICLjgJA8Yj57MH08L2I+IOOAkeepuuebruW9lT8\/PyIuZm9ybWF0KGl0ZW0ubmFtZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgIuiOt+WPluWIsCDjgJA8Yj57MH08L2I+44CRIOeahOWGheWuuSB7MX0g6aG5Ii5mb3JtYXQoaXRlbS5uYW1lLCBmaWxlcy5sZW5ndGgpKSk7CiAgICAgICAgYXdhaXQgZGVsYXkoMjAwKTsKICAgICAgICBJbm5lckNyZWF0ZVNoYTFMaW5rcyhmaWxlcyxpdGVtLm5hbWUpOwoKICAgIH0KCgogICAgZnVuY3Rpb24gQWRkRG93bmxvYWRTaGExQnRuKGpOb2RlKSB7CiAgICAgICAgdmFyIGZpbGU9IiI7CgogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bnNoYTFmaWxlJykgPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgZGl2PSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkaWFsb2ctaW5wdXQgaW5wdXQtb2ZmbGluZScpOwoKICAgICAgICAgICAgY29uc29sZS5sb2coZGl2KTsKICAgICAgICAgICAgdmFyICRmaWxlSW5wdXQgPSAkKCc8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxMHB4OyI+PGE+5oiW6ICF5a+85YWlc2hhMemTvuaOpeaWh+S7tu+8iHR4dC9qc29u77yJPC9hPjxpbnB1dCBjbGFzcz0iYnRuLXN0cm9rZSIgdHlwZT0iZmlsZSIgaWQ9ImRvd25zaGExZmlsZSIgYWNjZXB0PSIudHh0LC5qc29uIj48L2lucHV0PjwvZGl2PicpOwogICAgICAgICAgICB2YXIgJG5lZWRQYXRoPSQoJzxkaXYgc3R5bGU9Im1hcmdpbi10b3A6IDEwcHg7Ij48YT5zaGEx6L2s5a2Y5pe25LiN6KaB57uZ5oiR5Yib5bu655uu5b2V77yaPC9hPjxkaXYgY2xhc3M9Im9wdGlvbi1zd2l0Y2giIHN0eWxlPSJ0b3A6MTBweCI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZG93bnNoYTFuZWVkcGF0aCI+PGxhYmVsIGZvcj0iIj48aT7lvIDlkK88L2k+PHM+5YWz6ZetPC9zPjxiPuWIh+aNojwvYj48L2xhYmVsPjwvZGl2PicpOwogICAgICAgICAgICBkaXZbMF0uc3R5bGUuZGlzcGxheT0nZ3JpZCc7CiAgICAgICAgICAgIGRpdlswXS5hcHBlbmRDaGlsZCgkZmlsZUlucHV0WzBdKTsKICAgICAgICAgICAgZGl2WzBdLmFwcGVuZENoaWxkKCRuZWVkUGF0aFswXSk7CiAgICAgICAgICAgICRmaWxlSW5wdXRbMF0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlLnRhcmdldC5maWxlcyk7CiAgICAgICAgICAgICAgICBpZihlLnRhcmdldC5maWxlcyl7CiAgICAgICAgICAgICAgICAgICAgIGZpbGU9ZS50YXJnZXQuZmlsZXNbMF07fQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBmaWxlPSIiO30KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3duc2hhMWZpbGUnKS52YWx1ZT0iIjsKICAgICAgICAgICAgZmlsZT0iIjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25zaGExbmVlZHBhdGgnKS5jaGVja2VkPWZhbHNlOwogICAgICAgICAgICAKICAgICAgICB9CgoKICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25zaGExJykgPT0gbnVsbCkgewoKICAgICAgICAgICAgdmFyICRidG4gPSAkKCc8ZGl2IGNsYXNzPSJjb24iIGlkPSJkb3duc2hhMSI+PGEgY2xhc3M9ImJ1dHRvbiIgaHJlZj0iamF2YXNjcmlwdDo7Ij5zaGEx6ZO+5o6l6L2s5a2YPC9hPjwvZGl2PicpOwogICAgICAgICAgICBqTm9kZVswXS5hcHBlbmRDaGlsZCgkYnRuWzBdKTsKICAgICAgICAgICAgJGJ0blswXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewoKICAgICAgICAgICAgICAgIHZhciBjaWQgPSAkKCJlbVtyZWw9b2ZmbGludF9wYXRoX3RleHRdIikuYXR0cigiY2lkIik7CiAgICAgICAgICAgICAgICBpZiAoY2lkID09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgLy\/nm67lvZXkuI3lrZjlnKjvvIzmr5TlpoLmioog4oCc5LqR5LiL6L294oCdIOebruW9leWIoOmZpAogICAgICAgICAgICAgICAgICAgIGNpZCA9ICcwJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBsaW5rcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc19vZmZsaW5lX25ld19hZGQnKS52YWx1ZTsKCiAgICAgICAgICAgICAgICB2YXIgbmVlZFRvQ3JlYXRlUGFyZW50Rm9sZGVyPSFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bnNoYTFuZWVkcGF0aCcpLmNoZWNrZWQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibmVlZFRvQ3JlYXRlUGFyZW50Rm9sZGVyOnswfSIuZm9ybWF0KG5lZWRUb0NyZWF0ZVBhcmVudEZvbGRlcikpOwogICAgICAgICAgICAgICAgaWYoZmlsZSl7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBmaWxlPSIiOwogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHQudGFyZ2V0LnJlc3VsdCkKICAgICAgICAgICAgICAgICAgICAgICAgTmV3RG93bmxvYWRGaWxlRnJvbVNoYTFMaW5rcyhjaWQsIHQudGFyZ2V0LnJlc3VsdCxuZWVkVG9DcmVhdGVQYXJlbnRGb2xkZXIpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOZXdEb3dubG9hZEZpbGVGcm9tU2hhMUxpbmtzKGNpZCwgbGlua3MsbmVlZFRvQ3JlYXRlUGFyZW50Rm9sZGVyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2xvc2UnKVsyXS5jbGljaygpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgIH0KCgogICAgZnVuY3Rpb24gQWRkU2hhcmVTSEExQnRuKGpOb2RlKSB7CiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBqTm9kZVswXS5wYXJlbnROb2RlOwogICAgICAgIHZhciBwSXRlbSA9IEdldEZpbGVJdGVtQnlsaU5vZGUocGFyZW50Tm9kZSk7CiAgICAgICAgdmFyICRidG4gPSAkKCc8YT48aT48L2k+PHNwYW4+6I635Y+WIFNIQTEg6ZO+5o6lPC9zcGFuPjwvYT4nKTsKICAgICAgICAkYnRuLmFwcGVuZFRvKGpOb2RlWzBdKTsKICAgICAgICAkYnRuWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBJdGVtKTsKICAgICAgICAgICAgLy\/nlJ\/miJBzaGExCiAgICAgICAgICAgIENyZWF0ZVNoYTFMaW5rcyhwSXRlbSk7CiAgICAgICAgfSkKCgogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIEdldFNlYXJjaExpc3QoaXNPbmx5U2VsZWN0ZWQpewogICAgICAgIHZhciBtc2cgPSAi5q2j5Zyo6I635Y+W5paH5Lu2Li4uIjsKICAgICAgICBwb3N0U2hhMU1lc3NnYWUoY3JlYXRlTWVzc2FnZShNZXNzYWdlVHlwZS5CRUdJTiwgbXNnKSk7CgogICAgICAgIHZhciBkb2M9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2VhcmNoLWlmcmFtZScpWzBdOwogICAgICAgIGlmKCFkb2MpIGRvYz1kb2N1bWVudDsKICAgICAgICB2YXIgbGlzPWRvYy5xdWVyeVNlbGVjdG9yQWxsKCcubGlzdC1jZWxsLmxzdGMtc2VhcmNoID4gLmxpc3QtY29udGVudHMgPiB1bCA+IGxpJyk7CiAgICAgICAgaWYoIWxpcykgcmV0dXJuOwogICAgICAgIGNvbnNvbGUubG9nKGxpcyk7CiAgICAgICAgdmFyIGZpbGVzPW5ldyBBcnJheSgpOwogICAgICAgIGZvcih2YXIgbGkgb2YgbGlzKXsKICAgICAgICAgICB2YXIgZmlsZUl0ZW09IEdldEZpbGVJdGVtQnlsaU5vZGUobGkpOwogICAgICAgICAgIGZpbGVzLnB1c2goZmlsZUl0ZW0pOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZygiMDogc2VhcmNoIGl0ZW1zezB9Ii5mb3JtYXQoZmlsZXMubGVuZ3RoKSk7CiAgICAgICAgaWYoaXNPbmx5U2VsZWN0ZWQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coInNlYXJjaCBpdGVtcyBvbmx5U2VsZWN0ZWQiKQogICAgICAgICAgICBmaWxlcz1maWxlcy5maWx0ZXIocT0+cS5zZWxlY3RlZCk7CiAgICAgICAgfQoKICAgICAgICBjb25zb2xlLmxvZygiMTogc2VhcmNoIGl0ZW1zezB9Ii5mb3JtYXQoZmlsZXMubGVuZ3RoKSk7CgogICAgICAgIGNvbnNvbGUubG9nKGRvY3VtZW50LlVSTCk7CiAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwoZG9jdW1lbnQuVVJMKTsKICAgICAgICB2YXIga2V5ID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoInNlYXJjaF92YWx1ZSIpOwogICAgICAgIGtleT1rZXk\/a2V5OiLmkJzntKLnu5PmnpwiOwogICAgICAgIGZpbGVzPWZpbGVzLmZpbHRlcihxPT4hcS5pc0ZvbGRlcik7CiAgICAgICAgbXNnID0gIuiOt+WPluWIsOespuWQiOaQnOe0oueahOaWh+S7tuaVsO+8mnswfSIuZm9ybWF0KGZpbGVzLmxlbmd0aCk7CiAgICAgICAgcG9zdFNoYTFNZXNzZ2FlKGNyZWF0ZU1lc3NhZ2UoTWVzc2FnZVR5cGUuUFJPQ0VTU0lORywgbXNnKSk7CiAgICAgICAgYXdhaXQgZGVsYXkoMjAwKTsKICAgICAgICBhd2FpdCBJbm5lckNyZWF0ZVNoYTFMaW5rcyhmaWxlcyxrZXkpCgogICAgfQoKCgoKICAgIGZ1bmN0aW9uIEFkZFNoYXJlQnV0dG9uRm9yU2VhcmNoSXRlbShub2RlKXsKCiAgICAgICAgLy\/mr4\/kuIDpobkKICAgICAgICB2YXIgbGlzPSBub2RlWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaScpOwogICAgICAgIGZvciAodmFyIGxpIG9mIGxpcyl7CiAgICAgICAgICAgIHZhciBwSXRlbSA9IEdldEZpbGVJdGVtQnlsaU5vZGUobGkpOwogICAgICAgICAgICB2YXIgJGJ0biA9ICQoJzxkaXYgY2xhc3M9ImZpbGUtb3ByIiBzdHlsZT0ibGVmdDoyMDBweCI+PC9kaXY+Jyk7CiAgICAgICAgICAgICRidG4uYXBwZW5kVG8obGkpOwogICAgICAgIH0KCiAgICAgICAgLy\/pkojlr7nlvZPliY3pobXpnaIKICAgICAgICAkKCIubGVmdC10dmYgPiBhLmJ0bi11cGxvYWQiKS5jc3MoInRvcCIsIjEwcHgiKTsKICAgICAgICBpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuX3NlbGVjdGVkX3NoYTEnKT09bnVsbCl7CiAgICAgICAgICAgIHZhciAkYnRuX3NlbGVjdGVkID0gJChgPGEgaHJlZj0iamF2YXNjcmlwdDo7IiBpZD0iYnRuX3NlbGVjdGVkX3NoYTEiIGNsYXNzPSJidXR0b24gYnRuLWxpbmUiIHN0eWxlPSJ0b3A6MTBweCI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJpY29uLW9wZXJhdGUgaWZvLXNoYXJlIj48L2k+CiAgICAgICAgICAgIDxzcGFuPuaPkOWPluacrOmhtemAieS4reaWh+S7tu+8iOS4jeWMheaLrOaWh+S7tuWkue+8iTwvc3Bhbj4KICAgICAgICAgICAgPGVtIHN0eWxlPSJkaXNwbGF5Om5vbmU7IiBjbGFzcz0ibnVtLWRvdCI+PC9lbT4KICAgICAgICAgICAgPC9hPmApOwogICAgICAgICAgICAkKCIubGVmdC10dmYiKS5lcSgwKS5hcHBlbmQoJGJ0bl9zZWxlY3RlZCk7CgogICAgICAgICAgICAkYnRuX3NlbGVjdGVkWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxlPT57CiAgICAgICAgICAgICAgICBHZXRTZWFyY2hMaXN0KHRydWUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5fYWxsX3NoYTEnKT09bnVsbCl7CiAgICAgICAgICAgIHZhciAkYnRuX2FsbCA9ICQoYDxhIGhyZWY9ImphdmFzY3JpcHQ6OyIgaWQ9ImJ0bl9hbGxfc2hhMSIgY2xhc3M9ImJ1dHRvbiBidG4tbGluZSIgc3R5bGU9InRvcDoxMHB4Ij4KICAgICAgICAgICAgPGkgY2xhc3M9Imljb24tb3BlcmF0ZSBpZm8tc2hhcmUiPjwvaT4KICAgICAgICAgICAgPHNwYW4+5o+Q5Y+W5pys6aG15omA5pyJ5paH5Lu277yI5LiN5YyF5ous5paH5Lu25aS577yJPC9zcGFuPgogICAgICAgICAgICA8ZW0gc3R5bGU9ImRpc3BsYXk6bm9uZTsiIGNsYXNzPSJudW0tZG90Ij48L2VtPgogICAgICAgICAgICA8L2E+YCk7CiAgICAgICAgICAgICQoIi5sZWZ0LXR2ZiIpLmVxKDApLmFwcGVuZCgkYnRuX2FsbCk7CiAgICAKICAgICAgICAgICAgJGJ0bl9hbGxbMF0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGU9PnsKICAgICAgICAgICAgICAgIEdldFNlYXJjaExpc3QoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCgogICAgfQoKCgp9KSgpOwo="
}
